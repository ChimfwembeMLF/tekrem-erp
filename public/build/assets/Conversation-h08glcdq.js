import{u as We,r as l,j as n,R as ee,a as nt,A as ke,S as Ls}from"./app-BMIA6nir.js";import{A as zs}from"./AppLayout-DbMk6clK.js";import{C as Ps}from"./CustomerLayout-7LFTkDxI.js";import{t as P}from"./index-Dj2TB_RL.js";import{u as Fs}from"./useTypedPage-hmuARwun.js";import{c as De,B as T,u as Zn,P as $s,i as Us,a as Bs}from"./createLucideIcon-Cg8jdX0w.js";import{C as $e,a as Ue,b as Be,c as He}from"./card-BAsSN-2Z.js";import{T as Qn}from"./textarea-CP26afIU.js";import{X as Le,U as Qt,B as ve}from"./x-C3KwZK3B.js";import{A as en,b as tn,a as nn}from"./avatar-DdiG0YBt.js";import{T as Hs,a as Xs,b as jt,c as Nt}from"./tabs-YflTNJKH.js";import{D as qs,a as Ys,b as Ks,c as Ct,g as Sn,e as Kt}from"./NotificationComponent-CHA3vjZG.js";import{P as Vs,a as Ws,b as Gs}from"./popover-DnpdJ-hq.js";import{S as es}from"./smile-DTiT-A4G.js";import{E as Js}from"./ellipsis-DJ3pNpl6.js";import{S as ts}from"./square-pen-CReBrXbl.js";import{M as sn}from"./message-square-32k9udjC.js";import{H as rn}from"./history-DEH5TO3o.js";import{u as Zs,c as Ye,C as Qs}from"./index-BN56TOeV.js";import{c as er}from"./index-DdwO_6Rs.js";import{d as ns,u as tr,e as nr,A as sr,D as rr,C as ar,f as or}from"./index-BeGDJhOY.js";import{P as ir}from"./index-DgfI6AGt.js";import{R as lr}from"./index-DTi2vEM4.js";import{C as Rn}from"./circle-alert-DVIk47WR.js";import{S as cr}from"./save-D6UyxhH5.js";import{I as dr}from"./input-Bg5GDATO.js";import{T as ur}from"./trash-2-DZc0jDKK.js";import{S as ss}from"./send-C-AP4C9s.js";import{F as Dt}from"./file-text-D25AipK4.js";import{C as hr}from"./clock-BTinGqFV.js";import{s as fr}from"./index-sFwGSaal.js";import{A as kn}from"./arrow-left-UX2kDF52.js";import{M as Dn}from"./message-circle-CVsRMw7b.js";import{C as St}from"./chevron-left-DHDjM8I8.js";import{M as En,a as mr}from"./minimize-2-hoi5Bn2y.js";import{S as gr}from"./sparkles-Csmgo_ih.js";import{D as Tn}from"./download-CNZP3fGS.js";import{I as pr}from"./image-Ct2miMof.js";import{P as Vt}from"./paperclip-BkqMpcId.js";import{I as xr}from"./info-CVuj-Sjk.js";import{U as vr}from"./users-3SuyoAg3.js";import{P as br}from"./plus-BjPf5uI-.js";import{F as Mn}from"./file-CV9MO8iA.js";import{V as yr}from"./video-CV7uNjDn.js";import{A as wr}from"./archive-Bntya-At.js";import"./sheet-1SUjjT9Y.js";import"./AppProvider-NPNBF0OW.js";import"./useTranslate-ER5gAOX6.js";import"./dollar-sign-Cli0KufN.js";import"./trending-up-00s2SIxN.js";import"./smartphone-BqGcJ2Wh.js";import"./shield-DwKJ9Ble.js";import"./building-DIkCZBBP.js";import"./ticket-B_Ks_Sjf.js";import"./book-open-DEtrBf1m.js";import"./calendar-DTsvo4Hi.js";import"./graduation-cap-leaforsl.js";import"./brain-D-NomhzH.js";import"./user-cog-hTW3YbTW.js";import"./key-Qw2I2-NE.js";import"./bot-COuCQh0r.js";import"./globe-S29F6yCY.js";import"./share-2-cOWypco3.js";import"./chevron-down-CrO8JO_i.js";import"./log-out-B525vUfE.js";import"./index-DwXxsQvB.js";import"./bell-5VRgJnzP.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],In=De("check-check",jr);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],An=De("ellipsis-vertical",Nr);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Sr=De("grip-vertical",Cr);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],kr=De("music",Rr);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M15 9.34V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H7.89",key:"znwnzq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h11",key:"c9qhm2"}]],Er=De("pin-off",Dr);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],Ot=De("pin",Tr);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],an=De("reply",Mr);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]],On=De("sticky-note",Ir);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Or=De("zoom-in",Ar);function _r({message:e,currentUserId:t,onReply:s,onShowComments:r,onEdit:a,onShowEditHistory:o,onRefresh:i}){var b,j;const u=We(),[d,h]=l.useState(!1),f=["👍","❤️","😂","😮","😢","😡","👏","🎉"],m=((b=e.user)==null?void 0:b.id)===t&&e.message_type!=="system"&&new Date(e.created_at).getTime()>Date.now()-15*60*1e3,g=(()=>{if(!e.reactions)return null;for(const w of e.reactions)if(w.users.includes(t))return w.emoji;return null})(),y=async w=>{var N,C;try{const S=(N=e.reactions)==null?void 0:N.some(L=>L.emoji===w&&L.users.includes(t)),D=u("crm.livechat.messages.react",e.id),k=await fetch(D,{method:S?"DELETE":"POST",headers:{"X-CSRF-TOKEN":((C=document.querySelector('meta[name="csrf-token"]'))==null?void 0:C.getAttribute("content"))||"","Content-Type":"application/json"},body:JSON.stringify({emoji:w})});if(k.ok){const L=await k.json();P.success(S?"Reaction removed":"Reaction changed"),i()}else throw new Error("Failed to update reaction")}catch{P.error("Failed to update reaction")}h(!1)},x=async()=>{var w;try{const N=e.is_pinned?u("crm.livechat.messages.unpin",e.id):u("crm.livechat.messages.pin",e.id),C=e.is_pinned?"DELETE":"POST",S=await fetch(N,{method:C,headers:{"X-CSRF-TOKEN":((w=document.querySelector('meta[name="csrf-token"]'))==null?void 0:w.getAttribute("content"))||"","Content-Type":"application/json"}});if(S.ok){const D=await S.json();P.success(D.message),i()}else{const D=await S.json();P.error(D.error||"Failed to update pin status")}}catch{P.error("Failed to update pin status")}};return n.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsxs(Vs,{open:d,onOpenChange:h,children:[n.jsx(Ws,{asChild:!0,children:n.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:n.jsx(es,{className:"h-3 w-3"})})}),n.jsxs(Gs,{className:"w-auto p-2",align:"start",children:[g&&n.jsxs("div",{className:"mb-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded text-xs text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-700",children:["You reacted with ",g,". Click another emoji to change your reaction."]}),n.jsx("div",{className:"grid grid-cols-4 gap-1",children:f.map(w=>{const N=g===w;return n.jsx(T,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 text-lg transition-colors ${N?"bg-blue-100 dark:bg-blue-900/50 border border-blue-300 dark:border-blue-600 text-blue-700 dark:text-blue-300":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,onClick:()=>y(w),title:N?"Remove your reaction":"React with this emoji",children:w},w)})})]})]}),n.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>s(e),children:n.jsx(an,{className:"h-3 w-3"})}),n.jsxs(qs,{children:[n.jsx(Ys,{asChild:!0,children:n.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:n.jsx(Js,{className:"h-3 w-3"})})}),n.jsxs(Ks,{align:"end",className:"w-48",children:[m&&n.jsxs(n.Fragment,{children:[n.jsxs(Ct,{onClick:()=>a(e),children:[n.jsx(ts,{className:"h-4 w-4 mr-2"}),"Edit Message"]}),n.jsx(Sn,{})]}),n.jsxs(Ct,{onClick:()=>r(e),children:[n.jsx(sn,{className:"h-4 w-4 mr-2"}),"Comments (",((j=e.comments)==null?void 0:j.length)||0,")"]}),e.is_edited&&n.jsxs(Ct,{onClick:()=>o(e),children:[n.jsx(rn,{className:"h-4 w-4 mr-2"}),"Edit History (",e.is_edited?"edited":"",")"]}),n.jsx(Sn,{}),n.jsx(Ct,{onClick:x,children:e.is_pinned?n.jsxs(n.Fragment,{children:[n.jsx(Er,{className:"h-4 w-4 mr-2"}),"Unpin Message"]}):n.jsxs(n.Fragment,{children:[n.jsx(Ot,{className:"h-4 w-4 mr-2"}),"Pin Message"]})})]})]})]})}var[_t,ll]=er("Tooltip",[ns]),Lt=ns(),rs="TooltipProvider",Lr=700,on="tooltip.open",[zr,gn]=_t(rs),as=e=>{const{__scopeTooltip:t,delayDuration:s=Lr,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:o}=e,i=l.useRef(!0),u=l.useRef(!1),d=l.useRef(0);return l.useEffect(()=>{const h=d.current;return()=>window.clearTimeout(h)},[]),n.jsx(zr,{scope:t,isOpenDelayedRef:i,delayDuration:s,onOpen:l.useCallback(()=>{window.clearTimeout(d.current),i.current=!1},[]),onClose:l.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:u,onPointerInTransitChange:l.useCallback(h=>{u.current=h},[]),disableHoverableContent:a,children:o})};as.displayName=rs;var ot="Tooltip",[Pr,zt]=_t(ot),os=e=>{const{__scopeTooltip:t,children:s,open:r,defaultOpen:a,onOpenChange:o,disableHoverableContent:i,delayDuration:u}=e,d=gn(ot,e.__scopeTooltip),h=Lt(t),[f,m]=l.useState(null),p=tr(),g=l.useRef(0),y=i??d.disableHoverableContent,x=u??d.delayDuration,b=l.useRef(!1),[j,w]=Zs({prop:r,defaultProp:a??!1,onChange:R=>{R?(d.onOpen(),document.dispatchEvent(new CustomEvent(on))):d.onClose(),o==null||o(R)},caller:ot}),N=l.useMemo(()=>j?b.current?"delayed-open":"instant-open":"closed",[j]),C=l.useCallback(()=>{window.clearTimeout(g.current),g.current=0,b.current=!1,w(!0)},[w]),S=l.useCallback(()=>{window.clearTimeout(g.current),g.current=0,w(!1)},[w]),D=l.useCallback(()=>{window.clearTimeout(g.current),g.current=window.setTimeout(()=>{b.current=!0,w(!0),g.current=0},x)},[x,w]);return l.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=0)},[]),n.jsx(nr,{...h,children:n.jsx(Pr,{scope:t,contentId:p,open:j,stateAttribute:N,trigger:f,onTriggerChange:m,onTriggerEnter:l.useCallback(()=>{d.isOpenDelayedRef.current?D():C()},[d.isOpenDelayedRef,D,C]),onTriggerLeave:l.useCallback(()=>{y?S():(window.clearTimeout(g.current),g.current=0)},[S,y]),onOpen:C,onClose:S,disableHoverableContent:y,children:s})})};os.displayName=ot;var ln="TooltipTrigger",is=l.forwardRef((e,t)=>{const{__scopeTooltip:s,...r}=e,a=zt(ln,s),o=gn(ln,s),i=Lt(s),u=l.useRef(null),d=Zn(t,u,a.onTriggerChange),h=l.useRef(!1),f=l.useRef(!1),m=l.useCallback(()=>h.current=!1,[]);return l.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),n.jsx(sr,{asChild:!0,...i,children:n.jsx($s.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:d,onPointerMove:Ye(e.onPointerMove,p=>{p.pointerType!=="touch"&&!f.current&&!o.isPointerInTransitRef.current&&(a.onTriggerEnter(),f.current=!0)}),onPointerLeave:Ye(e.onPointerLeave,()=>{a.onTriggerLeave(),f.current=!1}),onPointerDown:Ye(e.onPointerDown,()=>{a.open&&a.onClose(),h.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:Ye(e.onFocus,()=>{h.current||a.onOpen()}),onBlur:Ye(e.onBlur,a.onClose),onClick:Ye(e.onClick,a.onClose)})})});is.displayName=ln;var Fr="TooltipPortal",[cl,$r]=_t(Fr,{forceMount:void 0}),Ve="TooltipContent",ls=l.forwardRef((e,t)=>{const s=$r(Ve,e.__scopeTooltip),{forceMount:r=s.forceMount,side:a="top",...o}=e,i=zt(Ve,e.__scopeTooltip);return n.jsx(ir,{present:r||i.open,children:i.disableHoverableContent?n.jsx(cs,{side:a,...o,ref:t}):n.jsx(Ur,{side:a,...o,ref:t})})}),Ur=l.forwardRef((e,t)=>{const s=zt(Ve,e.__scopeTooltip),r=gn(Ve,e.__scopeTooltip),a=l.useRef(null),o=Zn(t,a),[i,u]=l.useState(null),{trigger:d,onClose:h}=s,f=a.current,{onPointerInTransitChange:m}=r,p=l.useCallback(()=>{u(null),m(!1)},[m]),g=l.useCallback((y,x)=>{const b=y.currentTarget,j={x:y.clientX,y:y.clientY},w=Yr(j,b.getBoundingClientRect()),N=Kr(j,w),C=Vr(x.getBoundingClientRect()),S=Gr([...N,...C]);u(S),m(!0)},[m]);return l.useEffect(()=>()=>p(),[p]),l.useEffect(()=>{if(d&&f){const y=b=>g(b,f),x=b=>g(b,d);return d.addEventListener("pointerleave",y),f.addEventListener("pointerleave",x),()=>{d.removeEventListener("pointerleave",y),f.removeEventListener("pointerleave",x)}}},[d,f,g,p]),l.useEffect(()=>{if(i){const y=x=>{const b=x.target,j={x:x.clientX,y:x.clientY},w=(d==null?void 0:d.contains(b))||(f==null?void 0:f.contains(b)),N=!Wr(j,i);w?p():N&&(p(),h())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[d,f,i,h,p]),n.jsx(cs,{...e,ref:o})}),[Br,Hr]=_t(ot,{isInside:!1}),Xr=Us("TooltipContent"),cs=l.forwardRef((e,t)=>{const{__scopeTooltip:s,children:r,"aria-label":a,onEscapeKeyDown:o,onPointerDownOutside:i,...u}=e,d=zt(Ve,s),h=Lt(s),{onClose:f}=d;return l.useEffect(()=>(document.addEventListener(on,f),()=>document.removeEventListener(on,f)),[f]),l.useEffect(()=>{if(d.trigger){const m=p=>{const g=p.target;g!=null&&g.contains(d.trigger)&&f()};return window.addEventListener("scroll",m,{capture:!0}),()=>window.removeEventListener("scroll",m,{capture:!0})}},[d.trigger,f]),n.jsx(rr,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:m=>m.preventDefault(),onDismiss:f,children:n.jsxs(ar,{"data-state":d.stateAttribute,...h,...u,ref:t,style:{...u.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[n.jsx(Xr,{children:r}),n.jsx(Br,{scope:s,isInside:!0,children:n.jsx(lr,{id:d.contentId,role:"tooltip",children:a||r})})]})})});ls.displayName=Ve;var ds="TooltipArrow",qr=l.forwardRef((e,t)=>{const{__scopeTooltip:s,...r}=e,a=Lt(s);return Hr(ds,s).isInside?null:n.jsx(or,{...a,...r,ref:t})});qr.displayName=ds;function Yr(e,t){const s=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),o=Math.abs(t.left-e.x);switch(Math.min(s,r,a,o)){case o:return"left";case a:return"right";case s:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function Kr(e,t,s=5){const r=[];switch(t){case"top":r.push({x:e.x-s,y:e.y+s},{x:e.x+s,y:e.y+s});break;case"bottom":r.push({x:e.x-s,y:e.y-s},{x:e.x+s,y:e.y-s});break;case"left":r.push({x:e.x+s,y:e.y-s},{x:e.x+s,y:e.y+s});break;case"right":r.push({x:e.x-s,y:e.y-s},{x:e.x-s,y:e.y+s});break}return r}function Vr(e){const{top:t,right:s,bottom:r,left:a}=e;return[{x:a,y:t},{x:s,y:t},{x:s,y:r},{x:a,y:r}]}function Wr(e,t){const{x:s,y:r}=e;let a=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const u=t[o],d=t[i],h=u.x,f=u.y,m=d.x,p=d.y;f>r!=p>r&&s<(m-h)*(r-f)/(p-f)+h&&(a=!a)}return a}function Gr(e){const t=e.slice();return t.sort((s,r)=>s.x<r.x?-1:s.x>r.x?1:s.y<r.y?-1:s.y>r.y?1:0),Jr(t)}function Jr(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const a=e[r];for(;t.length>=2;){const o=t[t.length-1],i=t[t.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))t.pop();else break}t.push(a)}t.pop();const s=[];for(let r=e.length-1;r>=0;r--){const a=e[r];for(;s.length>=2;){const o=s[s.length-1],i=s[s.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))s.pop();else break}s.push(a)}return s.pop(),t.length===1&&s.length===1&&t[0].x===s[0].x&&t[0].y===s[0].y?t:t.concat(s)}var Zr=as,Qr=os,ea=is,us=ls;const _n=Zr,Ln=Qr,zn=ea,cn=l.forwardRef(({className:e,sideOffset:t=4,...s},r)=>n.jsx(us,{ref:r,sideOffset:t,className:Bs("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));cn.displayName=us.displayName;function ta({messageId:e,reactions:t,currentUserId:s,onRefresh:r,style:a="default",position:o="left"}){const i=We();if(!t||t.length===0)return n.jsx("div",{className:"flex flex-wrap gap-1 mt-1 min-h-[1px]"});const u=async h=>{var f;try{const m=t.find(b=>b.emoji===h),p=m==null?void 0:m.users.includes(s),g=i("crm.livechat.messages.react",e),x=await fetch(g,{method:p?"DELETE":"POST",headers:{"X-CSRF-TOKEN":((f=document.querySelector('meta[name="csrf-token"]'))==null?void 0:f.getAttribute("content"))||"","Content-Type":"application/json"},body:JSON.stringify({emoji:h})});if(x.ok){const b=await x.json();P.success(p?"Reaction removed":"Reaction added"),r()}else throw new Error("Failed to update reaction")}catch{P.error("Failed to update reaction")}},d=h=>h.length===1?h.includes(s)?"You":"1 person":h.length===2&&h.includes(s)?"You and 1 other":h.includes(s)?`You and ${h.length-1} others`:`${h.length} people`;return a==="whatsapp"?n.jsx("div",{className:`absolute -bottom-2 ${o==="right"?"right-2":"left-2"} z-10`,children:n.jsx("div",{className:"flex flex-wrap gap-1 bg-white dark:bg-gray-800 rounded-full px-2 py-1 shadow-lg border border-gray-200 dark:border-gray-700",children:t.map(h=>{const f=h.users.includes(s);return n.jsx(_n,{children:n.jsxs(Ln,{children:[n.jsx(zn,{asChild:!0,children:n.jsxs("button",{className:`flex items-center gap-1 rounded-full px-1 py-0.5 transition-colors text-xs ${f?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 border border-blue-300 dark:border-blue-600":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,onClick:()=>u(h.emoji),children:[n.jsx("span",{className:"text-sm",children:h.emoji}),n.jsx("span",{className:`text-xs font-medium ${f?"text-blue-700 dark:text-blue-300":"text-gray-600 dark:text-gray-400"}`,children:h.count})]})}),n.jsx(cn,{children:n.jsxs("p",{className:"text-sm",children:[d(h.users)," reacted with ",h.emoji]})})]})},h.emoji)})})}):n.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.map(h=>{const f=h.users.includes(s);return n.jsx(_n,{children:n.jsxs(Ln,{children:[n.jsx(zn,{asChild:!0,children:n.jsxs(T,{variant:"ghost",size:"sm",className:`h-6 px-2 py-0 text-xs rounded-full border transition-colors ${f?"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100":"bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100"}`,onClick:()=>u(h.emoji),children:[n.jsx("span",{className:"mr-1",children:h.emoji}),n.jsx("span",{className:"text-xs",children:h.count})]})}),n.jsx(cn,{children:n.jsxs("p",{className:"text-sm",children:[d(h.users)," reacted with ",h.emoji]})})]})},h.emoji)})})}function na({message:e,isOpen:t,onClose:s,onRefresh:r}){var y;const a=We(),[o,i]=l.useState(e.message),[u,d]=l.useState(!1),[h,f]=l.useState(null);if(l.useEffect(()=>{t&&(i(e.message),f(null))},[t,e.message]),!t)return null;const m=async x=>{var b;if(x.preventDefault(),!o.trim()){f("Message cannot be empty");return}if(o.trim()===e.message){f("No changes detected");return}d(!0),f(null);try{const j=await fetch(a("crm.livechat.messages.edit",e.id),{method:"PUT",headers:{"X-CSRF-TOKEN":((b=document.querySelector('meta[name="csrf-token"]'))==null?void 0:b.getAttribute("content"))||"","Content-Type":"application/json"},body:JSON.stringify({message:o.trim()})}),w=await j.json();j.ok?(P.success("Message edited successfully"),r(),s()):f(w.error||"Failed to edit message")}catch{f("Failed to edit message. Please try again.")}finally{d(!1)}},p=()=>{i(e.message),f(null),s()},g=()=>{const x=new Date(e.created_at).getTime(),j=Date.now()-x,N=15*60*1e3-j;if(N<=0)return"Time expired";const C=Math.floor(N/6e4),S=Math.floor(N%6e4/1e3);return`${C}:${S.toString().padStart(2,"0")} remaining`};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs($e,{className:"w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[n.jsxs(Ue,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[n.jsxs(Be,{className:"flex items-center gap-2",children:[n.jsx(ts,{className:"h-5 w-5"}),"Edit Message"]}),n.jsx(T,{variant:"ghost",size:"sm",onClick:p,children:n.jsx(Le,{className:"h-4 w-4"})})]}),n.jsxs(He,{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[n.jsx(Rn,{className:"h-4 w-4 text-amber-600"}),n.jsxs("span",{className:"text-sm text-amber-700",children:["You can edit messages within 15 minutes of posting. ",g()]})]}),n.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"font-medium text-sm",children:((y=e.user)==null?void 0:y.name)||"Unknown User"}),n.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()}),e.is_edited&&n.jsx("span",{className:"text-xs text-gray-500 italic",children:"(edited)"})]}),n.jsx("p",{className:"text-sm text-gray-700 font-medium",children:"Original:"}),n.jsx("p",{className:"text-sm text-gray-600",children:e.message})]}),n.jsxs("form",{onSubmit:m,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{htmlFor:"editMessage",className:"text-sm font-medium",children:"Edit your message:"}),n.jsx(Qn,{id:"editMessage",value:o,onChange:x=>{i(x.target.value),f(null)},placeholder:"Type your message...",rows:4,disabled:u,className:"resize-none"}),h&&n.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[n.jsx(Rn,{className:"h-4 w-4"}),h]})]}),n.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[n.jsxs("span",{children:[o.length,"/5000 characters"]}),n.jsx("span",{children:o.trim()===e.message?"No changes":"Modified"})]}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(T,{type:"button",variant:"outline",onClick:p,disabled:u,children:"Cancel"}),n.jsxs(T,{type:"submit",disabled:u||!o.trim()||o.trim()===e.message,className:"flex items-center gap-2",children:[u?n.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):n.jsx(cr,{className:"h-4 w-4"}),u?"Saving...":"Save Changes"]})]})]})]})]})})}function sa({message:e,currentUserId:t,isOpen:s,onClose:r,onRefresh:a}){var g;const o=We(),[i,u]=l.useState(""),[d,h]=l.useState(!1);if(!s)return null;const f=async y=>{var x;if(y.preventDefault(),!!i.trim()){h(!0);try{const b=await fetch(o("crm.livechat.messages.comments.store",e.id),{method:"POST",headers:{"X-CSRF-TOKEN":((x=document.querySelector('meta[name="csrf-token"]'))==null?void 0:x.getAttribute("content"))||"","Content-Type":"application/json"},body:JSON.stringify({comment:i.trim()})});if(b.ok){const j=await b.json();P.success("Comment added successfully"),u(""),a()}else{const j=await b.json();throw new Error(j.message||"Failed to add comment")}}catch{P.error("Failed to add comment")}finally{h(!1)}}},m=async y=>{var x;try{const b=await fetch(o("crm.livechat.comments.destroy",y),{method:"DELETE",headers:{"X-CSRF-TOKEN":((x=document.querySelector('meta[name="csrf-token"]'))==null?void 0:x.getAttribute("content"))||"","Content-Type":"application/json"}});if(b.ok){const j=await b.json();P.success("Comment deleted successfully"),a()}else{const j=await b.json();throw new Error(j.message||"Failed to delete comment")}}catch{P.error("Failed to delete comment")}},p=y=>new Date(y).toLocaleString();return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs($e,{className:"w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[n.jsxs(Ue,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[n.jsxs(Be,{className:"flex items-center gap-2",children:[n.jsx(sn,{className:"h-5 w-5"}),"Comments on Message"]}),n.jsx(T,{variant:"ghost",size:"sm",onClick:r,children:n.jsx(Le,{className:"h-4 w-4"})})]}),n.jsxs(He,{className:"space-y-4",children:[n.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("span",{className:"font-medium text-sm",children:((g=e.user)==null?void 0:g.name)||"Unknown User"})}),n.jsx("p",{className:"text-sm text-gray-700",children:e.message})]}),n.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:e.comments&&e.comments.length>0?e.comments.map(y=>n.jsx("div",{className:"flex gap-3 p-3 bg-gray-50 rounded-lg",children:n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"font-medium text-sm",children:y.user.name}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs text-gray-500",children:p(y.created_at)}),y.user.id===t&&n.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:()=>m(y.id),children:n.jsx(ur,{className:"h-3 w-3"})})]})]}),n.jsx("p",{className:"text-sm text-gray-700",children:y.comment})]})},y.id)):n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(sn,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),n.jsx("p",{className:"text-sm",children:"No comments yet. Be the first to comment!"})]})}),n.jsxs("form",{onSubmit:f,className:"flex gap-2",children:[n.jsx(dr,{value:i,onChange:y=>u(y.target.value),placeholder:"Add a comment...",disabled:d,className:"flex-1"}),n.jsx(T,{type:"submit",disabled:d||!i.trim(),size:"sm",children:d?n.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):n.jsx(ss,{className:"h-4 w-4"})})]})]})]})})}function ra({message:e,isOpen:t,onClose:s}){var g;const r=We(),[a,o]=l.useState(null),[i,u]=l.useState(!1),[d,h]=l.useState(null);l.useEffect(()=>{t&&e.is_edited&&f()},[t,e.id]);const f=async()=>{var y;u(!0),h(null);try{const x=await fetch(r("crm.livechat.messages.edit-history",e.id),{headers:{"X-CSRF-TOKEN":((y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content"))||""}}),b=await x.json();x.ok?o(b):h(b.error||"Failed to load edit history")}catch{h("Failed to load edit history. Please try again.")}finally{u(!1)}};if(!t)return null;const m=y=>new Date(y).toLocaleString(),p=y=>{const x=new Date(y),j=Math.floor((new Date().getTime()-x.getTime())/6e4);return j<1?"Just now":j<60?`${j}m ago`:j<1440?`${Math.floor(j/60)}h ago`:`${Math.floor(j/1440)}d ago`};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs($e,{className:"w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[n.jsxs(Ue,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[n.jsxs(Be,{className:"flex items-center gap-2",children:[n.jsx(rn,{className:"h-5 w-5"}),"Message Edit History"]}),n.jsx(T,{variant:"ghost",size:"sm",onClick:s,children:n.jsx(Le,{className:"h-4 w-4"})})]}),n.jsx(He,{className:"space-y-4",children:i?n.jsxs("div",{className:"flex items-center justify-center py-8",children:[n.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent"}),n.jsx("span",{className:"ml-2",children:"Loading edit history..."})]}):d?n.jsxs("div",{className:"text-center py-8 text-red-600",children:[n.jsx(Dt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),n.jsx("p",{className:"text-sm",children:d})]}):a?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Qt,{className:"h-4 w-4 text-blue-600"}),n.jsx("span",{className:"font-medium",children:((g=e.user)==null?void 0:g.name)||"Unknown User"})]}),n.jsxs(ve,{variant:"outline",className:"text-blue-600 border-blue-600",children:[a.edit_count," ",a.edit_count===1?"edit":"edits"]})]}),a.edited_at&&n.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[n.jsx(hr,{className:"h-4 w-4"}),"Last edited ",p(a.edited_at)]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ve,{className:"bg-green-100 text-green-800 border-green-300",children:"Current Version"}),a.edited_at&&n.jsx("span",{className:"text-xs text-gray-500",children:m(a.edited_at)})]}),n.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:n.jsx("p",{className:"text-sm",children:a.current_message})})]}),n.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[n.jsx("h4",{className:"font-medium text-gray-900",children:"Edit History"}),a.edit_history.map((y,x)=>n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ve,{variant:"outline",className:"text-gray-600",children:["Version ",a.edit_history.length-x]}),n.jsx("span",{className:"text-xs text-gray-500",children:m(y.edited_at)}),y.edited_by_user&&n.jsxs("span",{className:"text-xs text-gray-500",children:["by ",y.edited_by_user.name]})]}),n.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:n.jsx("p",{className:"text-sm text-gray-700",children:y.previous_message})})]},x)),n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx(ve,{variant:"outline",className:"text-gray-600",children:"Original Message"})}),n.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:n.jsx("p",{className:"text-sm text-gray-700",children:a.original_message})})]})]})]}):n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(rn,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),n.jsx("p",{className:"text-sm",children:"No edit history available"})]})})]})})}function aa(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return l.useMemo(()=>r=>{t.forEach(a=>a(r))},t)}const Pt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ge(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function pn(e){return"nodeType"in e}function se(e){var t,s;return e?Ge(e)?e:pn(e)&&(t=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function xn(e){const{Document:t}=se(e);return e instanceof t}function ut(e){return Ge(e)?!1:e instanceof se(e).HTMLElement}function hs(e){return e instanceof se(e).SVGElement}function Je(e){return e?Ge(e)?e.document:pn(e)?xn(e)?e:ut(e)||hs(e)?e.ownerDocument:document:document:document}const Ne=Pt?l.useLayoutEffect:l.useEffect;function vn(e){const t=l.useRef(e);return Ne(()=>{t.current=e}),l.useCallback(function(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return t.current==null?void 0:t.current(...r)},[])}function oa(){const e=l.useRef(null),t=l.useCallback((r,a)=>{e.current=setInterval(r,a)},[]),s=l.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,s]}function it(e,t){t===void 0&&(t=[e]);const s=l.useRef(e);return Ne(()=>{s.current!==e&&(s.current=e)},t),s}function ht(e,t){const s=l.useRef();return l.useMemo(()=>{const r=e(s.current);return s.current=r,r},[...t])}function Tt(e){const t=vn(e),s=l.useRef(null),r=l.useCallback(a=>{a!==s.current&&(t==null||t(a,s.current)),s.current=a},[]);return[s,r]}function dn(e){const t=l.useRef();return l.useEffect(()=>{t.current=e},[e]),t.current}let Wt={};function ft(e,t){return l.useMemo(()=>{if(t)return t;const s=Wt[e]==null?0:Wt[e]+1;return Wt[e]=s,e+"-"+s},[e,t])}function fs(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return r.reduce((o,i)=>{const u=Object.entries(i);for(const[d,h]of u){const f=o[d];f!=null&&(o[d]=f+e*h)}return o},{...t})}}const Ke=fs(1),lt=fs(-1);function ia(e){return"clientX"in e&&"clientY"in e}function bn(e){if(!e)return!1;const{KeyboardEvent:t}=se(e.target);return t&&e instanceof t}function la(e){if(!e)return!1;const{TouchEvent:t}=se(e.target);return t&&e instanceof t}function un(e){if(la(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:s}=e.touches[0];return{x:t,y:s}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:s}=e.changedTouches[0];return{x:t,y:s}}}return ia(e)?{x:e.clientX,y:e.clientY}:null}const ct=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:s}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:s}=e;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(e){if(e)return[ct.Translate.toString(e),ct.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:s,easing:r}=e;return t+" "+s+"ms "+r}}}),Pn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ca(e){return e.matches(Pn)?e:e.querySelector(Pn)}const da={display:"none"};function ua(e){let{id:t,value:s}=e;return ee.createElement("div",{id:t,style:da},s)}function ha(e){let{id:t,announcement:s,ariaLiveType:r="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ee.createElement("div",{id:t,style:a,role:"status","aria-live":r,"aria-atomic":!0},s)}function fa(){const[e,t]=l.useState("");return{announce:l.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const ms=l.createContext(null);function ma(e){const t=l.useContext(ms);l.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function ga(){const[e]=l.useState(()=>new Set),t=l.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[l.useCallback(r=>{let{type:a,event:o}=r;e.forEach(i=>{var u;return(u=i[a])==null?void 0:u.call(i,o)})},[e]),t]}const pa={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},xa={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function va(e){let{announcements:t=xa,container:s,hiddenTextDescribedById:r,screenReaderInstructions:a=pa}=e;const{announce:o,announcement:i}=fa(),u=ft("DndLiveRegion"),[d,h]=l.useState(!1);if(l.useEffect(()=>{h(!0)},[]),ma(l.useMemo(()=>({onDragStart(m){let{active:p}=m;o(t.onDragStart({active:p}))},onDragMove(m){let{active:p,over:g}=m;t.onDragMove&&o(t.onDragMove({active:p,over:g}))},onDragOver(m){let{active:p,over:g}=m;o(t.onDragOver({active:p,over:g}))},onDragEnd(m){let{active:p,over:g}=m;o(t.onDragEnd({active:p,over:g}))},onDragCancel(m){let{active:p,over:g}=m;o(t.onDragCancel({active:p,over:g}))}}),[o,t])),!d)return null;const f=ee.createElement(ee.Fragment,null,ee.createElement(ua,{id:r,value:a.draggable}),ee.createElement(ha,{id:u,announcement:i}));return s?nt.createPortal(f,s):f}var $;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})($||($={}));function Mt(){}function Fn(e,t){return l.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function ba(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return l.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const be=Object.freeze({x:0,y:0});function gs(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function ps(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return s-r}function ya(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return r-s}function $n(e){let{left:t,top:s,height:r,width:a}=e;return[{x:t,y:s},{x:t+a,y:s},{x:t,y:s+r},{x:t+a,y:s+r}]}function xs(e,t){if(!e||e.length===0)return null;const[s]=e;return s[t]}function Un(e,t,s){return t===void 0&&(t=e.left),s===void 0&&(s=e.top),{x:t+e.width*.5,y:s+e.height*.5}}const wa=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=Un(t,t.left,t.top),o=[];for(const i of r){const{id:u}=i,d=s.get(u);if(d){const h=gs(Un(d),a);o.push({id:u,data:{droppableContainer:i,value:h}})}}return o.sort(ps)},ja=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=$n(t),o=[];for(const i of r){const{id:u}=i,d=s.get(u);if(d){const h=$n(d),f=a.reduce((p,g,y)=>p+gs(h[y],g),0),m=Number((f/4).toFixed(4));o.push({id:u,data:{droppableContainer:i,value:m}})}}return o.sort(ps)};function Na(e,t){const s=Math.max(t.top,e.top),r=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),i=a-r,u=o-s;if(r<a&&s<o){const d=t.width*t.height,h=e.width*e.height,f=i*u,m=f/(d+h-f);return Number(m.toFixed(4))}return 0}const Ca=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=[];for(const o of r){const{id:i}=o,u=s.get(i);if(u){const d=Na(u,t);d>0&&a.push({id:i,data:{droppableContainer:o,value:d}})}}return a.sort(ya)};function Sa(e,t,s){return{...e,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function vs(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:be}function Ra(e){return function(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return a.reduce((i,u)=>({...i,top:i.top+e*u.y,bottom:i.bottom+e*u.y,left:i.left+e*u.x,right:i.right+e*u.x}),{...s})}}const ka=Ra(1);function Da(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ea(e,t,s){const r=Da(t);if(!r)return e;const{scaleX:a,scaleY:o,x:i,y:u}=r,d=e.left-i-(1-a)*parseFloat(s),h=e.top-u-(1-o)*parseFloat(s.slice(s.indexOf(" ")+1)),f=a?e.width/a:e.width,m=o?e.height/o:e.height;return{width:f,height:m,top:h,right:d+f,bottom:h+m,left:d}}const Ta={ignoreTransform:!1};function Ze(e,t){t===void 0&&(t=Ta);let s=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:h,transformOrigin:f}=se(e).getComputedStyle(e);h&&(s=Ea(s,h,f))}const{top:r,left:a,width:o,height:i,bottom:u,right:d}=s;return{top:r,left:a,width:o,height:i,bottom:u,right:d}}function Bn(e){return Ze(e,{ignoreTransform:!0})}function Ma(e){const t=e.innerWidth,s=e.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function Ia(e,t){return t===void 0&&(t=se(e).getComputedStyle(e)),t.position==="fixed"}function Aa(e,t){t===void 0&&(t=se(e).getComputedStyle(e));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=t[a];return typeof o=="string"?s.test(o):!1})}function Ft(e,t){const s=[];function r(a){if(t!=null&&s.length>=t||!a)return s;if(xn(a)&&a.scrollingElement!=null&&!s.includes(a.scrollingElement))return s.push(a.scrollingElement),s;if(!ut(a)||hs(a)||s.includes(a))return s;const o=se(e).getComputedStyle(a);return a!==e&&Aa(a,o)&&s.push(a),Ia(a,o)?s:r(a.parentNode)}return e?r(e):s}function bs(e){const[t]=Ft(e,1);return t??null}function Gt(e){return!Pt||!e?null:Ge(e)?e:pn(e)?xn(e)||e===Je(e).scrollingElement?window:ut(e)?e:null:null}function ys(e){return Ge(e)?e.scrollX:e.scrollLeft}function ws(e){return Ge(e)?e.scrollY:e.scrollTop}function hn(e){return{x:ys(e),y:ws(e)}}var X;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(X||(X={}));function js(e){return!Pt||!e?!1:e===document.scrollingElement}function Ns(e){const t={x:0,y:0},s=js(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-s.width,y:e.scrollHeight-s.height},a=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,i=e.scrollTop>=r.y,u=e.scrollLeft>=r.x;return{isTop:a,isLeft:o,isBottom:i,isRight:u,maxScroll:r,minScroll:t}}const Oa={x:.2,y:.2};function _a(e,t,s,r,a){let{top:o,left:i,right:u,bottom:d}=s;r===void 0&&(r=10),a===void 0&&(a=Oa);const{isTop:h,isBottom:f,isLeft:m,isRight:p}=Ns(e),g={x:0,y:0},y={x:0,y:0},x={height:t.height*a.y,width:t.width*a.x};return!h&&o<=t.top+x.height?(g.y=X.Backward,y.y=r*Math.abs((t.top+x.height-o)/x.height)):!f&&d>=t.bottom-x.height&&(g.y=X.Forward,y.y=r*Math.abs((t.bottom-x.height-d)/x.height)),!p&&u>=t.right-x.width?(g.x=X.Forward,y.x=r*Math.abs((t.right-x.width-u)/x.width)):!m&&i<=t.left+x.width&&(g.x=X.Backward,y.x=r*Math.abs((t.left+x.width-i)/x.width)),{direction:g,speed:y}}function La(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:i}=window;return{top:0,left:0,right:o,bottom:i,width:o,height:i}}const{top:t,left:s,right:r,bottom:a}=e.getBoundingClientRect();return{top:t,left:s,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Cs(e){return e.reduce((t,s)=>Ke(t,hn(s)),be)}function za(e){return e.reduce((t,s)=>t+ys(s),0)}function Pa(e){return e.reduce((t,s)=>t+ws(s),0)}function Fa(e,t){if(t===void 0&&(t=Ze),!e)return;const{top:s,left:r,bottom:a,right:o}=t(e);bs(e)&&(a<=0||o<=0||s>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const $a=[["x",["left","right"],za],["y",["top","bottom"],Pa]];class yn{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Ft(s),a=Cs(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,i,u]of $a)for(const d of i)Object.defineProperty(this,d,{get:()=>{const h=u(r),f=a[o]-h;return this.rect[d]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class st{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...s)})},this.target=t}add(t,s,r){var a;(a=this.target)==null||a.addEventListener(t,s,r),this.listeners.push([t,s,r])}}function Ua(e){const{EventTarget:t}=se(e);return e instanceof t?e:Je(e)}function Jt(e,t){const s=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(s**2+r**2)>t:"x"in t&&"y"in t?s>t.x&&r>t.y:"x"in t?s>t.x:"y"in t?r>t.y:!1}var he;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(he||(he={}));function Hn(e){e.preventDefault()}function Ba(e){e.stopPropagation()}var I;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(I||(I={}));const Ss={start:[I.Space,I.Enter],cancel:[I.Esc],end:[I.Space,I.Enter,I.Tab]},Ha=(e,t)=>{let{currentCoordinates:s}=t;switch(e.code){case I.Right:return{...s,x:s.x+25};case I.Left:return{...s,x:s.x-25};case I.Down:return{...s,y:s.y+25};case I.Up:return{...s,y:s.y-25}}};class wn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new st(Je(s)),this.windowListeners=new st(se(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(he.Resize,this.handleCancel),this.windowListeners.add(he.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(he.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,r=t.node.current;r&&Fa(r),s(be)}handleKeyDown(t){if(bn(t)){const{active:s,context:r,options:a}=this.props,{keyboardCodes:o=Ss,coordinateGetter:i=Ha,scrollBehavior:u="smooth"}=a,{code:d}=t;if(o.end.includes(d)){this.handleEnd(t);return}if(o.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:h}=r.current,f=h?{x:h.left,y:h.top}:be;this.referenceCoordinates||(this.referenceCoordinates=f);const m=i(t,{active:s,context:r.current,currentCoordinates:f});if(m){const p=lt(m,f),g={x:0,y:0},{scrollableAncestors:y}=r.current;for(const x of y){const b=t.code,{isTop:j,isRight:w,isLeft:N,isBottom:C,maxScroll:S,minScroll:D}=Ns(x),R=La(x),k={x:Math.min(b===I.Right?R.right-R.width/2:R.right,Math.max(b===I.Right?R.left:R.left+R.width/2,m.x)),y:Math.min(b===I.Down?R.bottom-R.height/2:R.bottom,Math.max(b===I.Down?R.top:R.top+R.height/2,m.y))},L=b===I.Right&&!w||b===I.Left&&!N,E=b===I.Down&&!C||b===I.Up&&!j;if(L&&k.x!==m.x){const z=x.scrollLeft+p.x,Y=b===I.Right&&z<=S.x||b===I.Left&&z>=D.x;if(Y&&!p.y){x.scrollTo({left:z,behavior:u});return}Y?g.x=x.scrollLeft-z:g.x=b===I.Right?x.scrollLeft-S.x:x.scrollLeft-D.x,g.x&&x.scrollBy({left:-g.x,behavior:u});break}else if(E&&k.y!==m.y){const z=x.scrollTop+p.y,Y=b===I.Down&&z<=S.y||b===I.Up&&z>=D.y;if(Y&&!p.x){x.scrollTo({top:z,behavior:u});return}Y?g.y=x.scrollTop-z:g.y=b===I.Down?x.scrollTop-S.y:x.scrollTop-D.y,g.y&&x.scrollBy({top:-g.y,behavior:u});break}}this.handleMove(t,Ke(lt(m,this.referenceCoordinates),g))}}}handleMove(t,s){const{onMove:r}=this.props;t.preventDefault(),r(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}wn.activators=[{eventName:"onKeyDown",handler:(e,t,s)=>{let{keyboardCodes:r=Ss,onActivation:a}=t,{active:o}=s;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const u=o.activatorNode.current;return u&&e.target!==u?!1:(e.preventDefault(),a==null||a({event:e.nativeEvent}),!0)}return!1}}];function Xn(e){return!!(e&&"distance"in e)}function qn(e){return!!(e&&"delay"in e)}class jn{constructor(t,s,r){var a;r===void 0&&(r=Ua(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:o}=t,{target:i}=o;this.props=t,this.events=s,this.document=Je(i),this.documentListeners=new st(this.document),this.listeners=new st(r),this.windowListeners=new st(se(i)),this.initialCoordinates=(a=un(o))!=null?a:be,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(he.Resize,this.handleCancel),this.windowListeners.add(he.DragStart,Hn),this.windowListeners.add(he.VisibilityChange,this.handleCancel),this.windowListeners.add(he.ContextMenu,Hn),this.documentListeners.add(he.Keydown,this.handleKeydown),s){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(qn(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(Xn(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:r,onPending:a}=this.props;a(r,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(he.Click,Ba,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(he.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:r,initialCoordinates:a,props:o}=this,{onMove:i,options:{activationConstraint:u}}=o;if(!a)return;const d=(s=un(t))!=null?s:be,h=lt(a,d);if(!r&&u){if(Xn(u)){if(u.tolerance!=null&&Jt(h,u.tolerance))return this.handleCancel();if(Jt(h,u.distance))return this.handleStart()}if(qn(u)&&Jt(h,u.tolerance))return this.handleCancel();this.handlePending(u,h);return}t.cancelable&&t.preventDefault(),i(d)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===I.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Xa={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Nn extends jn{constructor(t){const{event:s}=t,r=Je(s.target);super(t,Xa,r)}}Nn.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return!s.isPrimary||s.button!==0?!1:(r==null||r({event:s}),!0)}}];const qa={move:{name:"mousemove"},end:{name:"mouseup"}};var fn;(function(e){e[e.RightClick=2]="RightClick"})(fn||(fn={}));class Ya extends jn{constructor(t){super(t,qa,Je(t.event.target))}}Ya.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return s.button===fn.RightClick?!1:(r==null||r({event:s}),!0)}}];const Zt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Ka extends jn{constructor(t){super(t,Zt)}static setup(){return window.addEventListener(Zt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Zt.move.name,t)};function t(){}}}Ka.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;const{touches:a}=s;return a.length>1?!1:(r==null||r({event:s}),!0)}}];var rt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(rt||(rt={}));var It;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(It||(It={}));function Va(e){let{acceleration:t,activator:s=rt.Pointer,canScroll:r,draggingRect:a,enabled:o,interval:i=5,order:u=It.TreeOrder,pointerCoordinates:d,scrollableAncestors:h,scrollableAncestorRects:f,delta:m,threshold:p}=e;const g=Ga({delta:m,disabled:!o}),[y,x]=oa(),b=l.useRef({x:0,y:0}),j=l.useRef({x:0,y:0}),w=l.useMemo(()=>{switch(s){case rt.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case rt.DraggableRect:return a}},[s,a,d]),N=l.useRef(null),C=l.useCallback(()=>{const D=N.current;if(!D)return;const R=b.current.x*j.current.x,k=b.current.y*j.current.y;D.scrollBy(R,k)},[]),S=l.useMemo(()=>u===It.TreeOrder?[...h].reverse():h,[u,h]);l.useEffect(()=>{if(!o||!h.length||!w){x();return}for(const D of S){if((r==null?void 0:r(D))===!1)continue;const R=h.indexOf(D),k=f[R];if(!k)continue;const{direction:L,speed:E}=_a(D,k,w,t,p);for(const z of["x","y"])g[z][L[z]]||(E[z]=0,L[z]=0);if(E.x>0||E.y>0){x(),N.current=D,y(C,i),b.current=E,j.current=L;return}}b.current={x:0,y:0},j.current={x:0,y:0},x()},[t,C,r,x,o,i,JSON.stringify(w),JSON.stringify(g),y,h,S,f,JSON.stringify(p)])}const Wa={x:{[X.Backward]:!1,[X.Forward]:!1},y:{[X.Backward]:!1,[X.Forward]:!1}};function Ga(e){let{delta:t,disabled:s}=e;const r=dn(t);return ht(a=>{if(s||!r||!a)return Wa;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[X.Backward]:a.x[X.Backward]||o.x===-1,[X.Forward]:a.x[X.Forward]||o.x===1},y:{[X.Backward]:a.y[X.Backward]||o.y===-1,[X.Forward]:a.y[X.Forward]||o.y===1}}},[s,t,r])}function Ja(e,t){const s=t!=null?e.get(t):void 0,r=s?s.node.current:null;return ht(a=>{var o;return t==null?null:(o=r??a)!=null?o:null},[r,t])}function Za(e,t){return l.useMemo(()=>e.reduce((s,r)=>{const{sensor:a}=r,o=a.activators.map(i=>({eventName:i.eventName,handler:t(i.handler,r)}));return[...s,...o]},[]),[e,t])}var dt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(dt||(dt={}));var mn;(function(e){e.Optimized="optimized"})(mn||(mn={}));const Yn=new Map;function Qa(e,t){let{dragging:s,dependencies:r,config:a}=t;const[o,i]=l.useState(null),{frequency:u,measure:d,strategy:h}=a,f=l.useRef(e),m=b(),p=it(m),g=l.useCallback(function(j){j===void 0&&(j=[]),!p.current&&i(w=>w===null?j:w.concat(j.filter(N=>!w.includes(N))))},[p]),y=l.useRef(null),x=ht(j=>{if(m&&!s)return Yn;if(!j||j===Yn||f.current!==e||o!=null){const w=new Map;for(let N of e){if(!N)continue;if(o&&o.length>0&&!o.includes(N.id)&&N.rect.current){w.set(N.id,N.rect.current);continue}const C=N.node.current,S=C?new yn(d(C),C):null;N.rect.current=S,S&&w.set(N.id,S)}return w}return j},[e,o,s,m,d]);return l.useEffect(()=>{f.current=e},[e]),l.useEffect(()=>{m||g()},[s,m]),l.useEffect(()=>{o&&o.length>0&&i(null)},[JSON.stringify(o)]),l.useEffect(()=>{m||typeof u!="number"||y.current!==null||(y.current=setTimeout(()=>{g(),y.current=null},u))},[u,m,g,...r]),{droppableRects:x,measureDroppableContainers:g,measuringScheduled:o!=null};function b(){switch(h){case dt.Always:return!1;case dt.BeforeDragging:return s;default:return!s}}}function Rs(e,t){return ht(s=>e?s||(typeof t=="function"?t(e):e):null,[t,e])}function eo(e,t){return Rs(e,t)}function to(e){let{callback:t,disabled:s}=e;const r=vn(t),a=l.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,s]);return l.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function $t(e){let{callback:t,disabled:s}=e;const r=vn(t),a=l.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[s]);return l.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function no(e){return new yn(Ze(e),e)}function Kn(e,t,s){t===void 0&&(t=no);const[r,a]=l.useState(null);function o(){a(d=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=d??s)!=null?h:null}const f=t(e);return JSON.stringify(d)===JSON.stringify(f)?d:f})}const i=to({callback(d){if(e)for(const h of d){const{type:f,target:m}=h;if(f==="childList"&&m instanceof HTMLElement&&m.contains(e)){o();break}}}}),u=$t({callback:o});return Ne(()=>{o(),e?(u==null||u.observe(e),i==null||i.observe(document.body,{childList:!0,subtree:!0})):(u==null||u.disconnect(),i==null||i.disconnect())},[e]),r}function so(e){const t=Rs(e);return vs(e,t)}const Vn=[];function ro(e){const t=l.useRef(e),s=ht(r=>e?r&&r!==Vn&&e&&t.current&&e.parentNode===t.current.parentNode?r:Ft(e):Vn,[e]);return l.useEffect(()=>{t.current=e},[e]),s}function ao(e){const[t,s]=l.useState(null),r=l.useRef(e),a=l.useCallback(o=>{const i=Gt(o.target);i&&s(u=>u?(u.set(i,hn(i)),new Map(u)):null)},[]);return l.useEffect(()=>{const o=r.current;if(e!==o){i(o);const u=e.map(d=>{const h=Gt(d);return h?(h.addEventListener("scroll",a,{passive:!0}),[h,hn(h)]):null}).filter(d=>d!=null);s(u.length?new Map(u):null),r.current=e}return()=>{i(e),i(o)};function i(u){u.forEach(d=>{const h=Gt(d);h==null||h.removeEventListener("scroll",a)})}},[a,e]),l.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,i)=>Ke(o,i),be):Cs(e):be,[e,t])}function Wn(e,t){t===void 0&&(t=[]);const s=l.useRef(null);return l.useEffect(()=>{s.current=null},t),l.useEffect(()=>{const r=e!==be;r&&!s.current&&(s.current=e),!r&&s.current&&(s.current=null)},[e]),s.current?lt(e,s.current):be}function oo(e){l.useEffect(()=>{if(!Pt)return;const t=e.map(s=>{let{sensor:r}=s;return r.setup==null?void 0:r.setup()});return()=>{for(const s of t)s==null||s()}},e.map(t=>{let{sensor:s}=t;return s}))}function io(e,t){return l.useMemo(()=>e.reduce((s,r)=>{let{eventName:a,handler:o}=r;return s[a]=i=>{o(i,t)},s},{}),[e,t])}function ks(e){return l.useMemo(()=>e?Ma(e):null,[e])}const Gn=[];function lo(e,t){t===void 0&&(t=Ze);const[s]=e,r=ks(s?se(s):null),[a,o]=l.useState(Gn);function i(){o(()=>e.length?e.map(d=>js(d)?r:new yn(t(d),d)):Gn)}const u=$t({callback:i});return Ne(()=>{u==null||u.disconnect(),i(),e.forEach(d=>u==null?void 0:u.observe(d))},[e]),a}function co(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ut(t)?t:e}function uo(e){let{measure:t}=e;const[s,r]=l.useState(null),a=l.useCallback(h=>{for(const{target:f}of h)if(ut(f)){r(m=>{const p=t(f);return m?{...m,width:p.width,height:p.height}:p});break}},[t]),o=$t({callback:a}),i=l.useCallback(h=>{const f=co(h);o==null||o.disconnect(),f&&(o==null||o.observe(f)),r(f?t(f):null)},[t,o]),[u,d]=Tt(i);return l.useMemo(()=>({nodeRef:u,rect:s,setRef:d}),[s,u,d])}const ho=[{sensor:Nn,options:{}},{sensor:wn,options:{}}],fo={current:{}},Et={draggable:{measure:Bn},droppable:{measure:Bn,strategy:dt.WhileDragging,frequency:mn.Optimized},dragOverlay:{measure:Ze}};class at extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,r;return(s=(r=this.get(t))==null?void 0:r.node.current)!=null?s:void 0}}const mo={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new at,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Mt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Et,measureDroppableContainers:Mt,windowRect:null,measuringScheduled:!1},go={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Mt,draggableNodes:new Map,over:null,measureDroppableContainers:Mt},Ut=l.createContext(go),Ds=l.createContext(mo);function po(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new at}}}function xo(e,t){switch(t.type){case $.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case $.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case $.DragEnd:case $.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $.RegisterDroppable:{const{element:s}=t,{id:r}=s,a=new at(e.droppable.containers);return a.set(r,s),{...e,droppable:{...e.droppable,containers:a}}}case $.SetDroppableDisabled:{const{id:s,key:r,disabled:a}=t,o=e.droppable.containers.get(s);if(!o||r!==o.key)return e;const i=new at(e.droppable.containers);return i.set(s,{...o,disabled:a}),{...e,droppable:{...e.droppable,containers:i}}}case $.UnregisterDroppable:{const{id:s,key:r}=t,a=e.droppable.containers.get(s);if(!a||r!==a.key)return e;const o=new at(e.droppable.containers);return o.delete(s),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function vo(e){let{disabled:t}=e;const{active:s,activatorEvent:r,draggableNodes:a}=l.useContext(Ut),o=dn(r),i=dn(s==null?void 0:s.id);return l.useEffect(()=>{if(!t&&!r&&o&&i!=null){if(!bn(o)||document.activeElement===o.target)return;const u=a.get(i);if(!u)return;const{activatorNode:d,node:h}=u;if(!d.current&&!h.current)return;requestAnimationFrame(()=>{for(const f of[d.current,h.current]){if(!f)continue;const m=ca(f);if(m){m.focus();break}}})}},[r,t,a,i,o]),null}function bo(e,t){let{transform:s,...r}=t;return e!=null&&e.length?e.reduce((a,o)=>o({transform:a,...r}),s):s}function yo(e){return l.useMemo(()=>({draggable:{...Et.draggable,...e==null?void 0:e.draggable},droppable:{...Et.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Et.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function wo(e){let{activeNode:t,measure:s,initialRect:r,config:a=!0}=e;const o=l.useRef(!1),{x:i,y:u}=typeof a=="boolean"?{x:a,y:a}:a;Ne(()=>{if(!i&&!u||!t){o.current=!1;return}if(o.current||!r)return;const h=t==null?void 0:t.node.current;if(!h||h.isConnected===!1)return;const f=s(h),m=vs(f,r);if(i||(m.x=0),u||(m.y=0),o.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const p=bs(h);p&&p.scrollBy({top:m.y,left:m.x})}},[t,i,u,r,s])}const Es=l.createContext({...be,scaleX:1,scaleY:1});var _e;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(_e||(_e={}));const jo=l.memo(function(t){var s,r,a,o;let{id:i,accessibility:u,autoScroll:d=!0,children:h,sensors:f=ho,collisionDetection:m=Ca,measuring:p,modifiers:g,...y}=t;const x=l.useReducer(xo,void 0,po),[b,j]=x,[w,N]=ga(),[C,S]=l.useState(_e.Uninitialized),D=C===_e.Initialized,{draggable:{active:R,nodes:k,translate:L},droppable:{containers:E}}=b,z=R!=null?k.get(R):null,Y=l.useRef({initial:null,translated:null}),te=l.useMemo(()=>{var F;return R!=null?{id:R,data:(F=z==null?void 0:z.data)!=null?F:fo,rect:Y}:null},[R,z]),le=l.useRef(null),[Ee,ye]=l.useState(null),[q,ne]=l.useState(null),ce=it(y,Object.values(y)),Ce=ft("DndDescribedBy",i),ze=l.useMemo(()=>E.getEnabled(),[E]),U=yo(p),{droppableRects:de,measureDroppableContainers:fe,measuringScheduled:Te}=Qa(ze,{dragging:D,dependencies:[L.x,L.y],config:U.droppable}),G=Ja(k,R),Se=l.useMemo(()=>q?un(q):null,[q]),re=wt(),ae=eo(G,U.draggable.measure);wo({activeNode:R!=null?k.get(R):null,config:re.layoutShiftCompensation,initialRect:ae,measure:U.draggable.measure});const A=Kn(G,U.draggable.measure,ae),Pe=Kn(G?G.parentElement:null),ue=l.useRef({activatorEvent:null,active:null,activeNode:G,collisionRect:null,collisions:null,droppableRects:de,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:E,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),we=E.getNodeFor((s=ue.current.over)==null?void 0:s.id),me=uo({measure:U.dragOverlay.measure}),Me=(r=me.nodeRef.current)!=null?r:G,Ie=D?(a=me.rect)!=null?a:A:null,mt=!!(me.nodeRef.current&&me.rect),gt=so(mt?null:A),Qe=ks(Me?se(Me):null),je=ro(D?we??G:null),Fe=lo(je),Ae=bo(g,{transform:{x:L.x-gt.x,y:L.y-gt.y,scaleX:1,scaleY:1},activatorEvent:q,active:te,activeNodeRect:A,containerNodeRect:Pe,draggingNodeRect:Ie,over:ue.current.over,overlayNodeRect:me.rect,scrollableAncestors:je,scrollableAncestorRects:Fe,windowRect:Qe}),pt=Se?Ke(Se,L):null,et=ao(je),Bt=Wn(et),Ht=Wn(et,[A]),Re=Ke(Ae,Bt),J=Ie?ka(Ie,Ae):null,oe=te&&J?m({active:te,collisionRect:J,droppableRects:de,droppableContainers:ze,pointerCoordinates:pt}):null,ge=xs(oe,"id"),[pe,xt]=l.useState(null),Xt=mt?Ae:Ke(Ae,Ht),qt=Sa(Xt,(o=pe==null?void 0:pe.rect)!=null?o:null,A),tt=l.useRef(null),vt=l.useCallback((F,K)=>{let{sensor:V,options:xe}=K;if(le.current==null)return;const Z=k.get(le.current);if(!Z)return;const W=F.nativeEvent,ie=new V({active:le.current,activeNode:Z,event:W,options:xe,context:ue,onAbort(v){if(!k.get(v))return;const{onDragAbort:O}=ce.current,_={id:v};O==null||O(_),w({type:"onDragAbort",event:_})},onPending(v,M,O,_){if(!k.get(v))return;const{onDragPending:H}=ce.current,Q={id:v,constraint:M,initialCoordinates:O,offset:_};H==null||H(Q),w({type:"onDragPending",event:Q})},onStart(v){const M=le.current;if(M==null)return;const O=k.get(M);if(!O)return;const{onDragStart:_}=ce.current,B={activatorEvent:W,active:{id:M,data:O.data,rect:Y}};nt.unstable_batchedUpdates(()=>{_==null||_(B),S(_e.Initializing),j({type:$.DragStart,initialCoordinates:v,active:M}),w({type:"onDragStart",event:B}),ye(tt.current),ne(W)})},onMove(v){j({type:$.DragMove,coordinates:v})},onEnd:c($.DragEnd),onCancel:c($.DragCancel)});tt.current=ie;function c(v){return async function(){const{active:O,collisions:_,over:B,scrollAdjustedTranslate:H}=ue.current;let Q=null;if(O&&H){const{cancelDrop:Xe}=ce.current;Q={activatorEvent:W,active:O,collisions:_,delta:H,over:B},v===$.DragEnd&&typeof Xe=="function"&&await Promise.resolve(Xe(Q))&&(v=$.DragCancel)}le.current=null,nt.unstable_batchedUpdates(()=>{j({type:v}),S(_e.Uninitialized),xt(null),ye(null),ne(null),tt.current=null;const Xe=v===$.DragEnd?"onDragEnd":"onDragCancel";if(Q){const qe=ce.current[Xe];qe==null||qe(Q),w({type:Xe,event:Q})}})}}},[k]),Yt=l.useCallback((F,K)=>(V,xe)=>{const Z=V.nativeEvent,W=k.get(xe);if(le.current!==null||!W||Z.dndKit||Z.defaultPrevented)return;const ie={active:W};F(V,K.options,ie)===!0&&(Z.dndKit={capturedBy:K.sensor},le.current=xe,vt(V,K))},[k,vt]),Oe=Za(f,Yt);oo(f),Ne(()=>{A&&C===_e.Initializing&&S(_e.Initialized)},[A,C]),l.useEffect(()=>{const{onDragMove:F}=ce.current,{active:K,activatorEvent:V,collisions:xe,over:Z}=ue.current;if(!K||!V)return;const W={active:K,activatorEvent:V,collisions:xe,delta:{x:Re.x,y:Re.y},over:Z};nt.unstable_batchedUpdates(()=>{F==null||F(W),w({type:"onDragMove",event:W})})},[Re.x,Re.y]),l.useEffect(()=>{const{active:F,activatorEvent:K,collisions:V,droppableContainers:xe,scrollAdjustedTranslate:Z}=ue.current;if(!F||le.current==null||!K||!Z)return;const{onDragOver:W}=ce.current,ie=xe.get(ge),c=ie&&ie.rect.current?{id:ie.id,rect:ie.rect.current,data:ie.data,disabled:ie.disabled}:null,v={active:F,activatorEvent:K,collisions:V,delta:{x:Z.x,y:Z.y},over:c};nt.unstable_batchedUpdates(()=>{xt(c),W==null||W(v),w({type:"onDragOver",event:v})})},[ge]),Ne(()=>{ue.current={activatorEvent:q,active:te,activeNode:G,collisionRect:J,collisions:oe,droppableRects:de,draggableNodes:k,draggingNode:Me,draggingNodeRect:Ie,droppableContainers:E,over:pe,scrollableAncestors:je,scrollAdjustedTranslate:Re},Y.current={initial:Ie,translated:J}},[te,G,oe,J,k,Me,Ie,de,E,pe,je,Re]),Va({...re,delta:L,draggingRect:J,pointerCoordinates:pt,scrollableAncestors:je,scrollableAncestorRects:Fe});const bt=l.useMemo(()=>({active:te,activeNode:G,activeNodeRect:A,activatorEvent:q,collisions:oe,containerNodeRect:Pe,dragOverlay:me,draggableNodes:k,droppableContainers:E,droppableRects:de,over:pe,measureDroppableContainers:fe,scrollableAncestors:je,scrollableAncestorRects:Fe,measuringConfiguration:U,measuringScheduled:Te,windowRect:Qe}),[te,G,A,q,oe,Pe,me,k,E,de,pe,fe,je,Fe,U,Te,Qe]),yt=l.useMemo(()=>({activatorEvent:q,activators:Oe,active:te,activeNodeRect:A,ariaDescribedById:{draggable:Ce},dispatch:j,draggableNodes:k,over:pe,measureDroppableContainers:fe}),[q,Oe,te,A,j,Ce,k,pe,fe]);return ee.createElement(ms.Provider,{value:N},ee.createElement(Ut.Provider,{value:yt},ee.createElement(Ds.Provider,{value:bt},ee.createElement(Es.Provider,{value:qt},h)),ee.createElement(vo,{disabled:(u==null?void 0:u.restoreFocus)===!1})),ee.createElement(va,{...u,hiddenTextDescribedById:Ce}));function wt(){const F=(Ee==null?void 0:Ee.autoScrollEnabled)===!1,K=typeof d=="object"?d.enabled===!1:d===!1,V=D&&!F&&!K;return typeof d=="object"?{...d,enabled:V}:{enabled:V}}}),No=l.createContext(null),Jn="button",Co="Draggable";function So(e){let{id:t,data:s,disabled:r=!1,attributes:a}=e;const o=ft(Co),{activators:i,activatorEvent:u,active:d,activeNodeRect:h,ariaDescribedById:f,draggableNodes:m,over:p}=l.useContext(Ut),{role:g=Jn,roleDescription:y="draggable",tabIndex:x=0}=a??{},b=(d==null?void 0:d.id)===t,j=l.useContext(b?Es:No),[w,N]=Tt(),[C,S]=Tt(),D=io(i,t),R=it(s);Ne(()=>(m.set(t,{id:t,key:o,node:w,activatorNode:C,data:R}),()=>{const L=m.get(t);L&&L.key===o&&m.delete(t)}),[m,t]);const k=l.useMemo(()=>({role:g,tabIndex:x,"aria-disabled":r,"aria-pressed":b&&g===Jn?!0:void 0,"aria-roledescription":y,"aria-describedby":f.draggable}),[r,g,x,b,y,f.draggable]);return{active:d,activatorEvent:u,activeNodeRect:h,attributes:k,isDragging:b,listeners:r?void 0:D,node:w,over:p,setNodeRef:N,setActivatorNodeRef:S,transform:j}}function Ro(){return l.useContext(Ds)}const ko="Droppable",Do={timeout:25};function Eo(e){let{data:t,disabled:s=!1,id:r,resizeObserverConfig:a}=e;const o=ft(ko),{active:i,dispatch:u,over:d,measureDroppableContainers:h}=l.useContext(Ut),f=l.useRef({disabled:s}),m=l.useRef(!1),p=l.useRef(null),g=l.useRef(null),{disabled:y,updateMeasurementsFor:x,timeout:b}={...Do,...a},j=it(x??r),w=l.useCallback(()=>{if(!m.current){m.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{h(Array.isArray(j.current)?j.current:[j.current]),g.current=null},b)},[b]),N=$t({callback:w,disabled:y||!i}),C=l.useCallback((k,L)=>{N&&(L&&(N.unobserve(L),m.current=!1),k&&N.observe(k))},[N]),[S,D]=Tt(C),R=it(t);return l.useEffect(()=>{!N||!S.current||(N.disconnect(),m.current=!1,N.observe(S.current))},[S,N]),l.useEffect(()=>(u({type:$.RegisterDroppable,element:{id:r,key:o,disabled:s,node:S,rect:p,data:R}}),()=>u({type:$.UnregisterDroppable,key:o,id:r})),[r]),l.useEffect(()=>{s!==f.current.disabled&&(u({type:$.SetDroppableDisabled,id:r,key:o,disabled:s}),f.current.disabled=s)},[r,o,s,u]),{active:i,rect:p,isOver:(d==null?void 0:d.id)===r,node:S,over:d,setNodeRef:D}}function Cn(e,t,s){const r=e.slice();return r.splice(s<0?r.length+s:s,0,r.splice(t,1)[0]),r}function To(e,t){return e.reduce((s,r,a)=>{const o=t.get(r);return o&&(s[a]=o),s},Array(e.length))}function Rt(e){return e!==null&&e>=0}function Mo(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}function Io(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Ts=e=>{let{rects:t,activeIndex:s,overIndex:r,index:a}=e;const o=Cn(t,r,s),i=t[a],u=o[a];return!u||!i?null:{x:u.left-i.left,y:u.top-i.top,scaleX:u.width/i.width,scaleY:u.height/i.height}},kt={scaleX:1,scaleY:1},Ao=e=>{var t;let{activeIndex:s,activeNodeRect:r,index:a,rects:o,overIndex:i}=e;const u=(t=o[s])!=null?t:r;if(!u)return null;if(a===s){const h=o[i];return h?{x:0,y:s<i?h.top+h.height-(u.top+u.height):h.top-u.top,...kt}:null}const d=Oo(o,a,s);return a>s&&a<=i?{x:0,y:-u.height-d,...kt}:a<s&&a>=i?{x:0,y:u.height+d,...kt}:{x:0,y:0,...kt}};function Oo(e,t,s){const r=e[t],a=e[t-1],o=e[t+1];return r?s<t?a?r.top-(a.top+a.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):a?r.top-(a.top+a.height):0:0}const Ms="Sortable",Is=ee.createContext({activeIndex:-1,containerId:Ms,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Ts,disabled:{draggable:!1,droppable:!1}});function _o(e){let{children:t,id:s,items:r,strategy:a=Ts,disabled:o=!1}=e;const{active:i,dragOverlay:u,droppableRects:d,over:h,measureDroppableContainers:f}=Ro(),m=ft(Ms,s),p=u.rect!==null,g=l.useMemo(()=>r.map(D=>typeof D=="object"&&"id"in D?D.id:D),[r]),y=i!=null,x=i?g.indexOf(i.id):-1,b=h?g.indexOf(h.id):-1,j=l.useRef(g),w=!Mo(g,j.current),N=b!==-1&&x===-1||w,C=Io(o);Ne(()=>{w&&y&&f(g)},[w,g,y,f]),l.useEffect(()=>{j.current=g},[g]);const S=l.useMemo(()=>({activeIndex:x,containerId:m,disabled:C,disableTransforms:N,items:g,overIndex:b,useDragOverlay:p,sortedRects:To(g,d),strategy:a}),[x,m,C.draggable,C.droppable,N,g,b,d,p,a]);return ee.createElement(Is.Provider,{value:S},t)}const Lo=e=>{let{id:t,items:s,activeIndex:r,overIndex:a}=e;return Cn(s,r,a).indexOf(t)},zo=e=>{let{containerId:t,isSorting:s,wasDragging:r,index:a,items:o,newIndex:i,previousItems:u,previousContainerId:d,transition:h}=e;return!h||!r||u!==o&&a===i?!1:s?!0:i!==a&&t===d},Po={duration:200,easing:"ease"},As="transform",Fo=ct.Transition.toString({property:As,duration:0,easing:"linear"}),$o={roleDescription:"sortable"};function Uo(e){let{disabled:t,index:s,node:r,rect:a}=e;const[o,i]=l.useState(null),u=l.useRef(s);return Ne(()=>{if(!t&&s!==u.current&&r.current){const d=a.current;if(d){const h=Ze(r.current,{ignoreTransform:!0}),f={x:d.left-h.left,y:d.top-h.top,scaleX:d.width/h.width,scaleY:d.height/h.height};(f.x||f.y)&&i(f)}}s!==u.current&&(u.current=s)},[t,s,r,a]),l.useEffect(()=>{o&&i(null)},[o]),o}function Bo(e){let{animateLayoutChanges:t=zo,attributes:s,disabled:r,data:a,getNewIndex:o=Lo,id:i,strategy:u,resizeObserverConfig:d,transition:h=Po}=e;const{items:f,containerId:m,activeIndex:p,disabled:g,disableTransforms:y,sortedRects:x,overIndex:b,useDragOverlay:j,strategy:w}=l.useContext(Is),N=Ho(r,g),C=f.indexOf(i),S=l.useMemo(()=>({sortable:{containerId:m,index:C,items:f},...a}),[m,a,C,f]),D=l.useMemo(()=>f.slice(f.indexOf(i)),[f,i]),{rect:R,node:k,isOver:L,setNodeRef:E}=Eo({id:i,data:S,disabled:N.droppable,resizeObserverConfig:{updateMeasurementsFor:D,...d}}),{active:z,activatorEvent:Y,activeNodeRect:te,attributes:le,setNodeRef:Ee,listeners:ye,isDragging:q,over:ne,setActivatorNodeRef:ce,transform:Ce}=So({id:i,data:S,attributes:{...$o,...s},disabled:N.draggable}),ze=aa(E,Ee),U=!!z,de=U&&!y&&Rt(p)&&Rt(b),fe=!j&&q,Te=fe&&de?Ce:null,Se=de?Te??(u??w)({rects:x,activeNodeRect:te,activeIndex:p,overIndex:b,index:C}):null,re=Rt(p)&&Rt(b)?o({id:i,items:f,activeIndex:p,overIndex:b}):C,ae=z==null?void 0:z.id,A=l.useRef({activeId:ae,items:f,newIndex:re,containerId:m}),Pe=f!==A.current.items,ue=t({active:z,containerId:m,isDragging:q,isSorting:U,id:i,index:C,items:f,newIndex:A.current.newIndex,previousItems:A.current.items,previousContainerId:A.current.containerId,transition:h,wasDragging:A.current.activeId!=null}),we=Uo({disabled:!ue,index:C,node:k,rect:R});return l.useEffect(()=>{U&&A.current.newIndex!==re&&(A.current.newIndex=re),m!==A.current.containerId&&(A.current.containerId=m),f!==A.current.items&&(A.current.items=f)},[U,re,m,f]),l.useEffect(()=>{if(ae===A.current.activeId)return;if(ae!=null&&A.current.activeId==null){A.current.activeId=ae;return}const Me=setTimeout(()=>{A.current.activeId=ae},50);return()=>clearTimeout(Me)},[ae]),{active:z,activeIndex:p,attributes:le,data:S,rect:R,index:C,newIndex:re,items:f,isOver:L,isSorting:U,isDragging:q,listeners:ye,node:k,overIndex:b,over:ne,setNodeRef:ze,setActivatorNodeRef:ce,setDroppableNodeRef:E,setDraggableNodeRef:Ee,transform:we??Se,transition:me()};function me(){if(we||Pe&&A.current.newIndex===C)return Fo;if(!(fe&&!bn(Y)||!h)&&(U||ue))return ct.Transition.toString({...h,property:As})}}function Ho(e,t){var s,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(s=e==null?void 0:e.draggable)!=null?s:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}function At(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Xo=[I.Down,I.Right,I.Up,I.Left],qo=(e,t)=>{let{context:{active:s,collisionRect:r,droppableRects:a,droppableContainers:o,over:i,scrollableAncestors:u}}=t;if(Xo.includes(e.code)){if(e.preventDefault(),!s||!r)return;const d=[];o.getEnabled().forEach(m=>{if(!m||m!=null&&m.disabled)return;const p=a.get(m.id);if(p)switch(e.code){case I.Down:r.top<p.top&&d.push(m);break;case I.Up:r.top>p.top&&d.push(m);break;case I.Left:r.left>p.left&&d.push(m);break;case I.Right:r.left<p.left&&d.push(m);break}});const h=ja({collisionRect:r,droppableRects:a,droppableContainers:d});let f=xs(h,"id");if(f===(i==null?void 0:i.id)&&h.length>1&&(f=h[1].id),f!=null){const m=o.get(s.id),p=o.get(f),g=p?a.get(p.id):null,y=p==null?void 0:p.node.current;if(y&&g&&m&&p){const b=Ft(y).some((D,R)=>u[R]!==D),j=Os(m,p),w=Yo(m,p),N=b||!j?{x:0,y:0}:{x:w?r.width-g.width:0,y:w?r.height-g.height:0},C={x:g.left,y:g.top};return N.x&&N.y?C:lt(C,N)}}}};function Os(e,t){return!At(e)||!At(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function Yo(e,t){return!At(e)||!At(t)||!Os(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}function Ko({message:e,index:t,onNavigateToMessage:s,getInitials:r}){var m,p,g;const{attributes:a,listeners:o,setNodeRef:i,transform:u,transition:d,isDragging:h}=Bo({id:e.id}),f={transform:ct.Transform.toString(u),transition:d,zIndex:h?1e3:void 0};return n.jsx("div",{ref:i,className:`bg-white dark:bg-gray-800 rounded-md p-2 border border-amber-200 dark:border-amber-700 shadow-sm cursor-pointer hover:shadow-md transition-all duration-200 ${t>0?"absolute":"relative"} ${h?"opacity-50":""}`,style:{...f,top:t>0?`${t*4}px`:"auto",left:t>0?`${t*4}px`:"auto",zIndex:h?1e3:3-t,width:t>0?`calc(100% - ${t*8}px)`:"100%"},onClick:()=>s(e.id),title:"Click to go to message • Drag to reorder",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("div",{...a,...o,className:"flex-shrink-0 cursor-grab active:cursor-grabbing opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",onClick:y=>y.stopPropagation(),children:n.jsx(Sr,{className:"h-3 w-3 text-gray-400"})}),n.jsxs(en,{className:"h-4 w-4 flex-shrink-0",children:[n.jsx(tn,{src:((m=e.user)==null?void 0:m.profile_photo_url)||void 0}),n.jsx(nn,{className:"text-xs",children:r(((p=e.user)==null?void 0:p.name)||"U")})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[n.jsx("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 truncate",children:((g=e.user)==null?void 0:g.name)||"Unknown User"}),n.jsx("span",{className:"text-xs text-gray-500 flex-shrink-0",children:new Date(e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),n.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 line-clamp-1",children:e.message})]}),n.jsx(Ot,{className:"h-3 w-3 text-amber-500 flex-shrink-0"})]})})}function Vo({pinnedMessages:e,onRefresh:t}){const[s,r]=l.useState(e),[a,o]=l.useState(!1),i=ba(Fn(Nn,{activationConstraint:{distance:8}}),Fn(wn,{coordinateGetter:qo})),u=m=>!m||typeof m!="string"?"U":m.split(" ").map(p=>p[0]).join("").toUpperCase(),d=m=>{if(a)return;const p=document.getElementById(`message-${m}`);p&&(p.scrollIntoView({behavior:"smooth",block:"center"}),p.classList.add("bg-yellow-100","dark:bg-yellow-900/30"),setTimeout(()=>{p.classList.remove("bg-yellow-100","dark:bg-yellow-900/30")},2e3))},h=()=>{o(!0)},f=async m=>{var y;o(!1);const{active:p,over:g}=m;if(p.id!==(g==null?void 0:g.id)){const x=s.findIndex(w=>w.id===p.id),b=s.findIndex(w=>w.id===(g==null?void 0:g.id)),j=Cn(s,x,b);r(j);try{(await fetch(fr("crm.livechat.messages.reorder-pins"),{method:"POST",headers:{"X-CSRF-TOKEN":((y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content"))||"","Content-Type":"application/json"},body:JSON.stringify({message_ids:j.map(N=>N.id)})})).ok?(P.success("Pinned messages reordered!"),t()):(r(e),P.error("Failed to reorder pinned messages"))}catch{r(e),P.error("Failed to reorder pinned messages")}}};return ee.useEffect(()=>{r(e)},[e]),!s||s.length===0?null:n.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 p-2 group",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(Ot,{className:"h-3 w-3 text-amber-600 dark:text-amber-400"}),n.jsxs("span",{className:"text-xs font-medium text-amber-800 dark:text-amber-200",children:["Pinned Messages (",s.length,"/3)"]}),n.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"• Drag to reorder"})]}),n.jsxs("div",{className:"relative",children:[n.jsx(jo,{sensors:i,collisionDetection:wa,onDragStart:h,onDragEnd:f,children:n.jsx(_o,{items:s.map(m=>m.id),strategy:Ao,children:s.map((m,p)=>n.jsx(Ko,{message:m,index:p,onNavigateToMessage:d,getInitials:u},m.id))})}),s.length>1&&n.jsx("div",{style:{height:`${(s.length-1)*4}px`}})]})]})}function dl({conversation:e,pinnedMessages:t=[],clients:s,leads:r,staff:a,userRole:o,project:i,teamMembers:u=[],isProjectChat:d=!1,isCustomerView:h=!1}){var F,K,V,xe,Z,W,ie;const f=We(),m=Fs(),[p,g]=l.useState(""),[y,x]=l.useState(!1),[b,j]=l.useState([]),[w,N]=l.useState(null),[C,S]=l.useState(()=>typeof window<"u"?window.innerWidth>=1024:!0),[D,R]=l.useState(!1),[k,L]=l.useState([]),[E,z]=l.useState([]),[Y,te]=l.useState(""),[le,Ee]=l.useState(!1),[ye,q]=l.useState(0),[ne,ce]=l.useState(!1),[Ce,ze]=l.useState(null),[U,de]=l.useState(null),[fe,Te]=l.useState(null),G=l.useRef(null),Se=l.useRef(null),re=l.useRef(null),ae=l.useRef(null),A=()=>{var v;const c=(v=document.querySelector('meta[name="csrf-token"]'))==null?void 0:v.getAttribute("content");if(!c)throw console.error("CSRF token not found"),new Error("CSRF token not found");return c},Pe=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","🥳","😏","😒","😞","😔","😟","😕","🙁","☹️","😣","😖","😫","😩","🥺","😢","😭","😤","😠","😡","🤬","👍","👎","👌","✌️","🤞","🤟","🤘","🤙","👈","👉","👆","🖕","👇","☝️","👋","🤚","🖐️","✋","🖖","👏","🙌","🤝","🙏","✍️","💪","🦾","🦿","🦵","🦶","👂","❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","❣️","💕","💞","💓","💗","💖","💘","💝","💟","☮️"],ue=()=>{var c;(c=G.current)==null||c.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{ue()},[e.messages]),l.useEffect(()=>{const c=v=>{ae.current&&!ae.current.contains(v.target)&&R(!1)};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[]),l.useEffect(()=>{const c=()=>{window.innerWidth<1024&&C&&S(!1)};return window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[C]);const we=async c=>{if(c.preventDefault(),!p.trim()&&k.length===0&&E.length===0)return;const v=k.length>0||E.length>0,M=E.length>0,O=P.loading("Sending message...",{description:v?"Uploading files...":"Delivering your message"});try{const _=new FormData;_.append("message",p.trim()||(v?"Attachment":"")),_.append("message_type",M?"image":v?"file":"text"),w!=null&&w.id&&_.append("reply_to_id",w.id.toString());let B=0;if(k.forEach(Q=>{_.append(`attachments[${B}]`,Q),B++}),E.forEach(Q=>{_.append(`attachments[${B}]`,Q),B++}),!(await fetch(f("crm.livechat.send-message",e.id),{method:"POST",body:_,headers:{"X-CSRF-TOKEN":A(),"X-Requested-With":"XMLHttpRequest"}})).ok)throw new Error("Failed to send message");P.success("Message sent!",{id:O,description:v?`Message with ${k.length+E.length} attachment(s) sent successfully`:"Your message has been delivered"}),g(""),N(null),L([]),z([]),R(!1),ke.reload()}catch(_){console.error("Failed to send message:",_),P.error("Failed to send message",{id:O,description:"Please check your connection and try again",action:{label:"Retry",onClick:()=>we(c)}})}},me=()=>{var c;(c=Se.current)==null||c.click()},Me=()=>{var c;(c=re.current)==null||c.click()},Ie=c=>{const v=c.target.files;!v||v.length===0||(L(M=>[...M,...Array.from(v)]),P.success(`${v.length} file(s) selected`,{description:`Ready to send ${v.length} file${v.length>1?"s":""}`}),Se.current&&(Se.current.value=""))},mt=c=>{const v=c.target.files;!v||v.length===0||(z(M=>[...M,...Array.from(v)]),P.success(`${v.length} image(s) selected`,{description:`Ready to send ${v.length} image${v.length>1?"s":""}`}),re.current&&(re.current.value=""))},gt=c=>{L(v=>v.filter((M,O)=>O!==c))},Qe=c=>{z(v=>v.filter((M,O)=>O!==c))},je=c=>{q(c),Ee(!0)},Fe=c=>{var M;if(!c||typeof c!="string")return n.jsx(Mn,{className:"h-4 w-4 text-gray-500"});switch((M=c.split(".").pop())==null?void 0:M.toLowerCase()){case"pdf":return n.jsx(Dt,{className:"h-4 w-4 text-red-500"});case"doc":case"docx":return n.jsx(Dt,{className:"h-4 w-4 text-blue-500"});case"xls":case"xlsx":return n.jsx(Dt,{className:"h-4 w-4 text-green-500"});case"zip":case"rar":return n.jsx(wr,{className:"h-4 w-4 text-yellow-500"});case"mp4":case"avi":case"mov":return n.jsx(yr,{className:"h-4 w-4 text-purple-500"});case"mp3":case"wav":return n.jsx(kr,{className:"h-4 w-4 text-pink-500"});default:return n.jsx(Mn,{className:"h-4 w-4 text-gray-500"})}},Ae=c=>{if(c===0)return"0 Bytes";const v=1024,M=["Bytes","KB","MB","GB"],O=Math.floor(Math.log(c)/Math.log(v));return parseFloat((c/Math.pow(v,O)).toFixed(2))+" "+M[O]},pt=c=>{g(v=>v+c),R(!1)},et=async()=>{if(!Y.trim())return;const c=P.loading("Adding note...",{description:"Saving internal note"});try{const v=new FormData;if(v.append("message",Y.trim()),v.append("message_type","text"),v.append("is_internal_note","1"),!(await fetch(f("crm.livechat.send-message",e.id),{method:"POST",body:v,headers:{"X-CSRF-TOKEN":A(),"X-Requested-With":"XMLHttpRequest"}})).ok)throw new Error("Failed to add note");P.success("Note added!",{id:c,description:"Internal note has been saved successfully"}),te(""),ke.reload()}catch(v){console.error("Failed to add note:",v),P.error("Failed to add note",{id:c,description:"Please try again",action:{label:"Retry",onClick:()=>et()}})}},Bt=c=>{switch(c.status){case"sent":return n.jsx(Qs,{className:"h-3 w-3 text-gray-400"});case"delivered":return n.jsx(In,{className:"h-3 w-3 text-blue-500"});case"read":return n.jsx(In,{className:"h-3 w-3 text-green-500"});default:return null}},Ht=c=>new Date(c).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),Re=c=>!c||typeof c!="string"?"U":c.split(" ").map(v=>v[0]).join("").toUpperCase(),J=c=>{var M;const v=(M=m.props.auth.user)==null?void 0:M.id;return c===v},oe=c=>!c.user_id&&!ge(c),ge=c=>{var v;return((v=c.metadata)==null?void 0:v.is_ai_response)===!0},pe=c=>c.user_id&&!ge(c),xt=c=>{var v,M,O;if(ge(c))return"TekRem AI Assistant";if(pe(c))return((v=c.user)==null?void 0:v.name)||"Agent";if(oe(c)){const _=(M=c.metadata)==null?void 0:M.guest_name,B=(O=c.metadata)==null?void 0:O.guest_email;return _&&B?`${_} (${B})`:_||B||"Guest"}return"Unknown"},Xt=c=>{var v,M;if(ge(c))return"AI";if(pe(c))return Re(((v=c.user)==null?void 0:v.name)||"Agent");if(oe(c)){const O=(M=c.metadata)==null?void 0:M.guest_name;return O?Re(O):"G"}return"U"},qt=c=>{N(c)},tt=c=>{ze(c)},vt=c=>{de(c)},Yt=c=>{Te(c)},Oe=()=>{ke.reload()},bt=h?Ps:zs,yt=n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{h&&d?ke.get(f("customer.projects.show",i==null?void 0:i.id)):d?ke.get(f("projects.show",i==null?void 0:i.id)):ke.get(f("crm.livechat.index"))},children:[n.jsx(kn,{className:"h-4 w-4 mr-2"}),d?"Back to Project":"Back to Chat"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Dn,{className:"h-5 w-5 text-blue-600"}),n.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:d?`${i==null?void 0:i.name} - Team Chat`:e.display_title}),d&&n.jsx(ve,{variant:"outline",className:"ml-2",children:"Project Chat"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ve,{variant:e.status==="active"?"default":"secondary",children:e.status}),n.jsx(ve,{variant:"outline",children:e.priority}),!h&&n.jsxs(n.Fragment,{children:[n.jsx(T,{variant:"outline",size:"sm",onClick:()=>S(!C),title:C?"Hide sidebar":"Show sidebar",className:`transition-colors ${C?"bg-blue-50 border-blue-200 text-blue-700":"hover:bg-gray-100"}`,children:C?n.jsx(Kt,{className:"h-4 w-4"}):n.jsx(St,{className:"h-4 w-4"})}),n.jsx(T,{variant:"outline",size:"sm",onClick:()=>{ce(!ne),P.success(ne?"Exited full screen":"Entered full screen",{description:ne?"Chat returned to normal view":"Chat is now in full screen mode"})},title:ne?"Exit full screen":"Enter full screen",children:ne?n.jsx(En,{className:"h-4 w-4"}):n.jsx(mr,{className:"h-4 w-4"})}),n.jsx(T,{variant:"outline",size:"sm",children:n.jsx(An,{className:"h-4 w-4"})})]})]})]}),wt=n.jsxs("div",{children:[n.jsx(Ls,{title:`Chat - ${e.display_title}`}),n.jsxs("div",{className:ne?"fixed inset-0 bg-white dark:bg-gray-900 z-50 flex flex-col":"h-[calc(100vh-8rem)] flex",children:[ne&&n.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-white dark:bg-gray-900",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{h&&d?ke.get(f("customer.projects.show",i==null?void 0:i.id)):d?ke.get(f("projects.show",i==null?void 0:i.id)):ke.get(f("crm.livechat.index"))},children:[n.jsx(kn,{className:"h-4 w-4 mr-2"}),d?"Back to Project":"Back to Chat"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Dn,{className:"h-5 w-5 text-blue-600"}),n.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:d?`${i==null?void 0:i.name} - Team Chat`:e.display_title}),d&&n.jsx(ve,{variant:"outline",className:"ml-2",children:"Project Chat"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ve,{variant:e.status==="active"?"default":"secondary",children:e.status}),n.jsx(ve,{variant:"outline",children:e.priority}),n.jsx(T,{variant:"outline",size:"sm",onClick:()=>S(!C),title:C?"Hide sidebar":"Show sidebar",className:`transition-colors ${C?"bg-blue-50 border-blue-200 text-blue-700":"hover:bg-gray-100"}`,children:C?n.jsx(Kt,{className:"h-4 w-4"}):n.jsx(St,{className:"h-4 w-4"})}),n.jsx(T,{variant:"outline",size:"sm",onClick:()=>{ce(!1),P.success("Exited full screen",{description:"Chat returned to normal view"})},title:"Exit full screen",children:n.jsx(En,{className:"h-4 w-4"})}),n.jsx(T,{variant:"outline",size:"sm",children:n.jsx(An,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:ne?"flex-1 flex overflow-hidden":"flex h-full w-full",children:[n.jsxs("div",{className:`flex flex-col transition-all duration-300 ease-in-out relative ${C&&!h?"flex-1":"w-full"}`,children:[!C&&!h&&n.jsx(T,{variant:"outline",size:"sm",onClick:()=>S(!0),title:"Show sidebar",className:"absolute top-4 right-4 z-20 bg-white dark:bg-gray-800 shadow-lg hover:shadow-xl transition-all duration-200 border-gray-300 dark:border-gray-600",children:n.jsx(St,{className:"h-4 w-4"})}),n.jsx(Vo,{pinnedMessages:t,onRefresh:Oe}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(F=e.messages)==null?void 0:F.map(c=>{var v,M,O,_,B;return n.jsx("div",{id:`message-${c.id}`,className:`group flex ${J(c.user_id)?"justify-end":(oe(c),"justify-start")} transition-colors duration-500`,children:n.jsxs("div",{className:`flex gap-2 max-w-[70%] ${J(c.user_id)?"flex-row-reverse":"flex-row"}`,children:[n.jsxs(en,{className:`h-8 w-8 ${ge(c)?"bg-purple-100 border-purple-200":oe(c)?"bg-blue-100 border-blue-200":""}`,children:[n.jsx(tn,{src:((v=c.user)==null?void 0:v.profile_photo_url)||void 0}),n.jsx(nn,{className:ge(c)?"bg-purple-100 text-purple-600":oe(c)?"bg-blue-100 text-blue-600":"",children:Xt(c)})]}),n.jsxs("div",{className:`space-y-1 ${J(c.user_id)?"items-end":"items-start"} flex flex-col`,children:[c.is_pinned&&n.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:[n.jsx(Ot,{className:"h-3 w-3"}),n.jsx("span",{children:"Pinned message"})]}),c.reply_to&&n.jsxs("div",{className:"text-xs text-gray-500 bg-gray-100 dark:bg-gray-800 rounded p-2 mb-1",children:[n.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[n.jsx(an,{className:"h-3 w-3"}),n.jsxs("span",{children:["Replying to ",(M=c.reply_to.user)==null?void 0:M.name]})]}),n.jsxs("p",{className:"truncate",children:[c.reply_to.message.substring(0,50),"..."]})]}),n.jsxs("div",{className:"relative",children:[n.jsxs("div",{className:`rounded-lg px-3 py-2 ${J(c.user_id)?"bg-blue-600 text-white":ge(c)?"bg-purple-50 border border-purple-200 text-gray-900":oe(c)?"bg-blue-50 border border-blue-200 text-gray-900":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[!J(c.user_id)&&n.jsx("div",{className:"flex items-center gap-1 mb-1",children:ge(c)?n.jsxs(n.Fragment,{children:[n.jsx(gr,{className:"w-3 h-3 text-purple-600"}),n.jsx("span",{className:"text-xs font-medium text-purple-600",children:"TekRem AI Assistant"})]}):oe(c)?n.jsxs(n.Fragment,{children:[n.jsx(Qt,{className:"w-3 h-3 text-blue-600"}),n.jsx("span",{className:"text-xs font-medium text-blue-600",children:xt(c)})]}):n.jsxs(n.Fragment,{children:[n.jsx(Qt,{className:"w-3 h-3 text-gray-600"}),n.jsx("span",{className:"text-xs font-medium text-gray-600",children:((O=c.user)==null?void 0:O.name)||"Agent"})]})}),c.is_internal_note&&n.jsx("div",{className:"text-xs opacity-75 mb-1",children:"🔒 Internal Note"}),n.jsx("p",{className:"whitespace-pre-wrap",children:c.message}),c.is_edited&&n.jsxs("div",{className:"text-xs opacity-75 mt-1",children:[n.jsx("span",{className:"italic",children:"edited"}),c.edited_at&&n.jsx("span",{className:"ml-1",children:new Date(c.edited_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}),c.attachments&&c.attachments.length>0&&n.jsx("div",{className:"mt-2 space-y-2",children:c.attachments.map((H,Q)=>{var qe;return((qe=H.mime_type)==null?void 0:qe.startsWith("image/"))?n.jsxs("div",{className:"max-w-xs",children:[n.jsxs("div",{className:"relative group",children:[n.jsx("img",{src:H.url,alt:H.name,className:"w-full rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{window.open(H.url,"_blank")}}),n.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 rounded-lg transition-colors flex items-center justify-center",children:n.jsx(T,{size:"sm",variant:"ghost",className:"opacity-0 group-hover:opacity-100 transition-opacity text-white bg-black/50 hover:bg-black/70",onClick:_s=>{_s.stopPropagation(),window.open(H.url,"_blank")},children:n.jsx(Or,{className:"h-4 w-4"})})})]}),n.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",children:H.name})]},Q):n.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white/10 rounded text-sm",children:[Fe(H.name),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"font-medium truncate",children:H.name}),n.jsx("p",{className:"text-xs opacity-75",children:H.size?Ae(H.size):"Unknown size"})]}),n.jsx(T,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>window.open(H.url,"_blank"),children:n.jsx(Tn,{className:"h-3 w-3"})})]},Q)})})]}),n.jsx(ta,{messageId:c.id,reactions:c.reactions||[],currentUserId:((_=e.creator)==null?void 0:_.id)||0,onRefresh:Oe,style:"whatsapp",position:J(c.user_id)?"right":"left"})]}),n.jsxs("div",{className:`flex items-center gap-2 text-xs text-gray-500 mt-1 ${J(c.user_id)?"flex-row-reverse":"flex-row"}`,children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{children:Ht(c.created_at)}),J(c.user_id)&&Bt(c)]}),n.jsx(_r,{message:c,currentUserId:((B=e.creator)==null?void 0:B.id)||0,onReply:qt,onShowComments:vt,onEdit:tt,onShowEditHistory:Yt,onRefresh:Oe})]})]})]})},c.id)}),b.length>0&&n.jsx("div",{className:"flex justify-start",children:n.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex space-x-1",children:[n.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),n.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),n.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),n.jsxs("span",{className:"text-xs text-gray-500",children:[b.join(", ")," ",b.length===1?"is":"are"," typing..."]})]})})}),n.jsx("div",{ref:G})]}),w&&n.jsx("div",{className:"px-4 py-2 bg-gray-50 dark:bg-gray-900 border-t",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx(an,{className:"h-4 w-4"}),n.jsxs("span",{children:["Replying to ",(K=w.user)==null?void 0:K.name]}),n.jsxs("span",{className:"text-gray-500",children:['"',w.message.substring(0,30),'..."']})]}),n.jsx(T,{size:"sm",variant:"ghost",onClick:()=>N(null),children:"×"})]})}),E.length>0&&n.jsxs("div",{className:"px-4 py-2 border-t bg-gray-50 dark:bg-gray-900",children:[n.jsx("div",{className:"mb-2",children:n.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Images to send:"})}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:E.map((c,v)=>n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"aspect-square bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:n.jsx("img",{src:URL.createObjectURL(c),alt:c.name,className:"w-full h-full object-cover cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>je(v)})}),n.jsx(T,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>Qe(v),children:n.jsx(Le,{className:"h-3 w-3"})}),n.jsx("div",{className:"absolute bottom-1 left-1 right-1",children:n.jsx("div",{className:"bg-black/50 text-white text-xs px-1 py-0.5 rounded truncate",children:c.name})})]},v))})]}),k.length>0&&n.jsxs("div",{className:"px-4 py-2 border-t bg-gray-50 dark:bg-gray-900",children:[n.jsx("div",{className:"mb-2",children:n.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Files to send:"})}),n.jsx("div",{className:"space-y-2",children:k.map((c,v)=>n.jsxs("div",{className:"flex items-center gap-3 bg-white dark:bg-gray-800 rounded-lg px-3 py-2 text-sm",children:[Fe(c.name),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"font-medium truncate",children:c.name}),n.jsx("p",{className:"text-xs text-gray-500",children:Ae(c.size)})]}),n.jsx(T,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>gt(v),children:n.jsx(Le,{className:"h-3 w-3"})})]},v))})]}),n.jsxs("div",{className:"p-4 border-t relative",children:[n.jsxs("form",{onSubmit:we,className:"rounded-full px-3 py-1.5 flex items-center gap-2 shadow-md",children:[n.jsx(T,{type:"button",variant:"unstyled",size:"icon",onClick:Me,title:"Send images",className:"text-gray-400 hover:text-white",children:n.jsx(pr,{className:"h-4 w-4"})}),n.jsx(T,{type:"button",variant:"unstyled",size:"icon",onClick:me,title:"Send files",className:"text-gray-400 hover:text-white",children:n.jsx(Vt,{className:"h-4 w-4"})}),n.jsx("div",{className:"flex-1 relative",children:n.jsx("textarea",{value:p,onChange:c=>g(c.target.value),placeholder:"Type a message...",className:"w-full text-white bg-transparent border-none outline-none focus:outline-none focus:ring-0 resize-none text-sm pt-3",rows:1,onKeyDown:c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),we(c))}})}),n.jsx(T,{type:"button",variant:"unstyled",size:"icon",className:"text-gray-400 hover:text-white",onClick:()=>R(!D),children:n.jsx(es,{className:"h-4 w-4"})}),n.jsx(T,{type:"submit",variant:"ghost",size:"icon",disabled:!p.trim()&&k.length===0&&E.length===0,className:"hover:bg-blue-700  disabled:opacity-50",children:n.jsx(ss,{className:"h-4 w-4"})})]}),D&&n.jsxs("div",{ref:ae,className:"absolute bottom-full right-4 mb-2 bg-white dark:bg-gray-800 border rounded-lg shadow-lg p-4 z-50 w-[100%]",children:[n.jsxs("div",{className:"flex justify-between items-center mb-3",children:[n.jsx("h4",{className:"text-sm font-medium",children:"Choose an emoji"}),n.jsx(T,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>R(!1),children:n.jsx(Le,{className:"h-3 w-3"})})]}),n.jsx("div",{className:"grid grid-cols-10 gap-1 max-h-48 overflow-y-auto",children:Pe.map((c,v)=>n.jsx("button",{type:"button",className:"text-lg hover:bg-gray-100 dark:hover:bg-gray-700 rounded p-1 transition-colors",onClick:()=>pt(c),children:c},v))})]}),n.jsx("input",{ref:Se,type:"file",multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.zip,.rar,.txt,.mp4,.avi,.mov,.mp3,.wav",className:"hidden",onChange:Ie}),n.jsx("input",{ref:re,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:mt})]})]}),!h&&n.jsx("div",{className:`border-l transition-all duration-300 ease-in-out overflow-hidden ${C?"w-80 lg:w-80 md:w-72 sm:w-64 opacity-100":"w-0 opacity-0"} ${C?"lg:relative md:absolute md:right-0 md:top-0 md:h-full md:z-30 md:shadow-lg":""}`,children:C&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"lg:hidden fixed inset-0 bg-black/50 z-20",onClick:()=>S(!1)}),n.jsxs(Hs,{defaultValue:"info",className:"h-full w-80 lg:w-80 md:w-72 sm:w-64 relative z-30",children:[n.jsxs("div",{className:"lg:hidden flex justify-between items-center p-3 border-b bg-white dark:bg-gray-800",children:[n.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Chat Details"}),n.jsx(T,{variant:"ghost",size:"sm",onClick:()=>S(!1),className:"h-8 w-8 p-0",children:n.jsx(Le,{className:"h-4 w-4"})})]}),n.jsxs(Xs,{className:`grid w-full dark:bg-black/0 rounded-none ${d?"grid-cols-4":"grid-cols-3"}`,children:[n.jsxs(jt,{value:"info",className:"flex items-center gap-1",children:[n.jsx(xr,{className:"h-3 w-3"}),"Info"]}),d&&n.jsxs(jt,{value:"team",className:"flex items-center gap-1",children:[n.jsx(vr,{className:"h-3 w-3"}),"Team"]}),n.jsxs(jt,{value:"files",className:"flex items-center gap-1",children:[n.jsx(Vt,{className:"h-3 w-3"}),"Files"]}),n.jsxs(jt,{value:"notes",className:"flex items-center gap-1",children:[n.jsx(On,{className:"h-3 w-3"}),"Notes"]})]}),n.jsx(Nt,{value:"info",className:"p-4 space-y-4 h-[calc(100%-3rem)] overflow-y-auto",children:n.jsxs($e,{children:[n.jsx(Ue,{children:n.jsx(Be,{className:"text-sm",children:"Conversation Details"})}),n.jsxs(He,{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Status"}),n.jsx("p",{className:"text-sm",children:e.status})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Priority"}),n.jsx("p",{className:"text-sm",children:e.priority})]}),e.assignee&&n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Assigned to"}),n.jsx("p",{className:"text-sm",children:e.assignee.name})]}),e.conversable&&n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Contact"}),n.jsx("p",{className:"text-sm",children:e.conversable.name}),n.jsx("p",{className:"text-xs text-gray-500",children:e.conversable.email})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Created"}),n.jsx("p",{className:"text-sm",children:new Date(e.created_at).toLocaleDateString()})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Last Activity"}),n.jsx("p",{className:"text-sm",children:e.last_message_at?new Date(e.last_message_at).toLocaleDateString():"No messages yet"})]})]})]})}),d&&n.jsx(Nt,{value:"team",className:"p-4 space-y-4 h-[calc(100%-3rem)] overflow-y-auto",children:n.jsxs($e,{children:[n.jsx(Ue,{children:n.jsx(Be,{className:"text-sm",children:"Project Team"})}),n.jsxs(He,{className:"space-y-3",children:[u.map(c=>n.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[n.jsxs(en,{className:"h-8 w-8",children:[n.jsx(tn,{src:c.profile_photo_url}),n.jsx(nn,{children:c.name.split(" ").map(v=>v[0]).join("").toUpperCase()})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:c.name}),n.jsx("p",{className:"text-xs text-gray-500 truncate",children:c.email})]}),c.id===(i==null?void 0:i.manager_id)&&n.jsx(ve,{variant:"secondary",className:"text-xs",children:"Manager"})]},c.id)),u.length===0&&n.jsx("p",{className:"text-sm text-gray-500",children:"No team members assigned"})]})]})}),n.jsx(Nt,{value:"files",className:"p-4 h-[calc(100%-3rem)] overflow-y-auto",children:n.jsxs($e,{children:[n.jsx(Ue,{children:n.jsx(Be,{className:"text-sm",children:"Shared Files"})}),n.jsx(He,{children:n.jsx("div",{className:"space-y-2",children:((V=e.messages)==null?void 0:V.filter(c=>c.attachments&&c.attachments.length>0).length)===0?n.jsx("p",{className:"text-sm text-gray-500",children:"No files shared yet"}):(xe=e.messages)==null?void 0:xe.filter(c=>c.attachments&&c.attachments.length>0).map(c=>{var v;return(v=c.attachments)==null?void 0:v.map((M,O)=>{var _;return n.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white dark:bg-gray-800 rounded border",children:[n.jsx(Vt,{className:"h-4 w-4 text-gray-400"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:M.name}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Shared by ",(_=c.user)==null?void 0:_.name," • ",new Date(c.created_at).toLocaleDateString()]})]}),n.jsx(T,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",children:n.jsx(Tn,{className:"h-3 w-3"})})]},`${c.id}-${O}`)})})})})]})}),n.jsx(Nt,{value:"notes",className:"p-4 h-[calc(100%-3rem)] overflow-y-auto",children:n.jsxs($e,{children:[n.jsx(Ue,{children:n.jsx(Be,{className:"text-sm",children:"Internal Notes"})}),n.jsxs(He,{className:"space-y-4",children:[o!=="customer"&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qn,{value:Y,onChange:c=>te(c.target.value),placeholder:"Add an internal note...",className:"min-h-[60px] text-sm"}),n.jsxs(T,{size:"sm",onClick:et,disabled:!Y.trim(),className:"w-full",children:[n.jsx(br,{className:"h-3 w-3 mr-1"}),"Add Note"]})]}),n.jsx("div",{className:"space-y-2",children:((Z=e.messages)==null?void 0:Z.filter(c=>c.is_internal_note).length)===0?n.jsx("p",{className:"text-sm text-gray-500",children:"No internal notes yet"}):(W=e.messages)==null?void 0:W.filter(c=>c.is_internal_note).map(c=>{var v;return n.jsx("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(On,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm",children:c.message}),n.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(v=c.user)==null?void 0:v.name," • ",new Date(c.created_at).toLocaleDateString()]})]})]})},c.id)})})]})]})})]})]})})]})]}),le&&E.length>0&&n.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center",children:n.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[n.jsx(T,{variant:"ghost",size:"sm",className:"absolute top-4 right-4 text-white hover:bg-white/20 z-10",onClick:()=>Ee(!1),children:n.jsx(Le,{className:"h-6 w-6"})}),E.length>1&&n.jsxs(n.Fragment,{children:[n.jsx(T,{variant:"ghost",size:"sm",className:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:bg-white/20 z-10",onClick:()=>q(c=>c>0?c-1:E.length-1),children:n.jsx(St,{className:"h-8 w-8"})}),n.jsx(T,{variant:"ghost",size:"sm",className:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:bg-white/20 z-10",onClick:()=>q(c=>c<E.length-1?c+1:0),children:n.jsx(Kt,{className:"h-8 w-8"})})]}),n.jsx("div",{className:"max-w-4xl max-h-[80vh] flex items-center justify-center",children:n.jsx("img",{src:URL.createObjectURL(E[ye]),alt:E[ye].name,className:"max-w-full max-h-full object-contain"})}),n.jsx("div",{className:"absolute bottom-4 left-4 right-4 text-white",children:n.jsxs("div",{className:"bg-black/50 rounded-lg p-4",children:[n.jsx("h3",{className:"font-medium",children:E[ye].name}),n.jsxs("p",{className:"text-sm text-gray-300",children:[Ae(E[ye].size),E.length>1&&n.jsxs("span",{className:"ml-2",children:[ye+1," of ",E.length]})]})]})})]})}),Ce&&n.jsx(na,{message:Ce,isOpen:!!Ce,onClose:()=>ze(null),onRefresh:Oe}),U&&n.jsx(sa,{message:U,currentUserId:((ie=e.creator)==null?void 0:ie.id)||0,isOpen:!!U,onClose:()=>de(null),onRefresh:Oe}),fe&&n.jsx(ra,{message:fe,isOpen:!!fe,onClose:()=>Te(null)})]});return h?n.jsxs(bt,{children:[!ne&&yt,wt]}):n.jsx(bt,{title:`Chat - ${e.display_title}`,renderHeader:()=>yt,children:wt})}export{dl as default};
