import{u as K,r as f,R as L,j as e,S as z,A as F}from"./app-BMIA6nir.js";import{A as V}from"./AppLayout-DbMk6clK.js";import{B as u}from"./createLucideIcon-Cg8jdX0w.js";import{C as j,a as b,b as P,c as g}from"./card-BAsSN-2Z.js";import{B as N}from"./x-C3KwZK3B.js";import{C as k}from"./checkbox-B8CiFAgv.js";import{u as q}from"./useTranslate-ER5gAOX6.js";import{S as v}from"./shield-DwKJ9Ble.js";import{K as D}from"./key-Qw2I2-NE.js";import{A as G}from"./arrow-left-UX2kDF52.js";import{R as J}from"./rotate-ccw-BcdmK91W.js";import{S as Q}from"./save-D6UyxhH5.js";import"./useTypedPage-hmuARwun.js";import"./sheet-1SUjjT9Y.js";import"./index-BN56TOeV.js";import"./index-DdwO_6Rs.js";import"./index-DgfI6AGt.js";import"./index-BeGDJhOY.js";import"./index-DwXxsQvB.js";import"./AppProvider-NPNBF0OW.js";import"./index-Dj2TB_RL.js";import"./users-3SuyoAg3.js";import"./message-square-32k9udjC.js";import"./message-circle-CVsRMw7b.js";import"./NotificationComponent-CHA3vjZG.js";import"./bell-5VRgJnzP.js";import"./dollar-sign-Cli0KufN.js";import"./file-text-D25AipK4.js";import"./trending-up-00s2SIxN.js";import"./smartphone-BqGcJ2Wh.js";import"./building-DIkCZBBP.js";import"./ticket-B_Ks_Sjf.js";import"./book-open-DEtrBf1m.js";import"./image-Ct2miMof.js";import"./calendar-DTsvo4Hi.js";import"./clock-BTinGqFV.js";import"./graduation-cap-leaforsl.js";import"./brain-D-NomhzH.js";import"./user-cog-hTW3YbTW.js";import"./plus-BjPf5uI-.js";import"./bot-COuCQh0r.js";import"./globe-S29F6yCY.js";import"./share-2-cOWypco3.js";import"./chevron-down-CrO8JO_i.js";import"./log-out-B525vUfE.js";import"./index-BDIc0y8N.js";function ze({matrix:m,groupedPermissions:x}){var S,w;q();const y=K(),[r,M]=f.useState(null),[o,p]=f.useState({}),[A,h]=f.useState(!1);L.useEffect(()=>{const s={};Object.values(m).forEach(t=>{s[t.role.id]=[...t.permissions]}),p(s)},[m]);const B=s=>{switch(s){case"admin":return"destructive";case"manager":return"default";case"staff":return"secondary";case"customer":return"outline";default:return"secondary"}},E=(s,t,i)=>{p(c=>{const a={...c};return a[s]||(a[s]=[]),i?a[s].includes(t)||(a[s]=[...a[s],t]):a[s]=a[s].filter(n=>n!==t),a}),h(!0)},O=(s,t,i)=>{var a;const c=((a=x[t])==null?void 0:a.map(n=>n.name))||[];p(n=>{const l={...n};if(l[s]||(l[s]=[]),i){const d=[...l[s]];c.forEach(R=>{d.includes(R)||d.push(R)}),l[s]=d}else l[s]=l[s].filter(d=>!c.includes(d));return l}),h(!0)},T=()=>{r&&F.post(y("admin.roles.matrix.update"),{role_id:r,permissions:o[r]||[]},{onSuccess:()=>{h(!1)}})},H=()=>{const s={};Object.values(m).forEach(t=>{s[t.role.id]=[...t.permissions]}),p(s),h(!1)},C=(s,t)=>{var a;const i=((a=x[t])==null?void 0:a.map(n=>n.name))||[],c=o[s]||[];return i.length>0&&i.every(n=>c.includes(n))},_=(s,t)=>{var a;const i=((a=x[t])==null?void 0:a.map(n=>n.name))||[],c=o[s]||[];return i.some(n=>c.includes(n))&&!C(s,t)};return e.jsxs(V,{title:"Permission Matrix",renderHeader:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:y("admin.roles.index"),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Back to Roles"]})}),e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Permission Matrix"})]}),A&&r&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:H,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Reset"]}),e.jsxs(u,{onClick:T,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]}),children:[e.jsx(z,{title:"Permission Matrix"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[e.jsxs(j,{children:[e.jsx(b,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Select Role to Manage"]})}),e.jsx(g,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.values(m).map(({role:s})=>{var t;return e.jsxs(u,{variant:r===s.id?"default":"outline",className:"h-auto p-4 flex flex-col items-start",onClick:()=>M(s.id),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(N,{variant:B(s.name),className:"text-xs",children:s.name})]}),e.jsx("p",{className:"text-xs text-left opacity-70",children:s.description||"No description"}),e.jsxs("p",{className:"text-xs text-left opacity-70 mt-1",children:[((t=o[s.id])==null?void 0:t.length)||0," permissions"]})]},s.id)})})})]}),r&&e.jsxs(j,{children:[e.jsx(b,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Permissions for ",(S=m[r])==null?void 0:S.role.name,((w=m[r])==null?void 0:w.role.is_system_role)&&e.jsx(N,{variant:"outline",children:"System Role"})]})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-6",children:Object.entries(x).map(([s,t])=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{checked:C(r,s),indeterminate:_(r,s),onCheckedChange:i=>O(r,s,!!i)}),e.jsxs("h3",{className:"font-medium text-lg capitalize",children:[s," Module"]}),e.jsxs(N,{variant:"secondary",children:[t.length," permissions"]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:t.map(i=>{var c;return e.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded",children:[e.jsx(k,{checked:((c=o[r])==null?void 0:c.includes(i.name))||!1,onCheckedChange:a=>E(r,i.name,!!a)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:i.name}),i.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.description})]})]},i.id)})})]},s))})})]}),!r&&e.jsx(j,{children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(v,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"Select a Role"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Choose a role above to view and manage its permissions."})]})})]})})]})}export{ze as default};
