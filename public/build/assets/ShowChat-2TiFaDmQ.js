import{r as d,G as P,j as e,S as R,x as _}from"./app-BMIA6nir.js";import{C as I}from"./CustomerLayout-7LFTkDxI.js";import{C as N,a as v,b as y,c as w}from"./card-BAsSN-2Z.js";import{B as n}from"./createLucideIcon-Cg8jdX0w.js";import{T as L}from"./textarea-CP26afIU.js";import{B as K}from"./x-C3KwZK3B.js";import{A as b,b as C,a as S}from"./avatar-DdiG0YBt.js";import{u as G}from"./useTranslate-ER5gAOX6.js";import{t as p}from"./index-Dj2TB_RL.js";import{A as U}from"./arrow-left-UX2kDF52.js";import{M as $}from"./message-circle-CVsRMw7b.js";import{P as h}from"./paperclip-BkqMpcId.js";import{D as H}from"./download-CNZP3fGS.js";import{S as V}from"./send-C-AP4C9s.js";import"./NotificationComponent-CHA3vjZG.js";import"./index-BN56TOeV.js";import"./index-DdwO_6Rs.js";import"./index-BeGDJhOY.js";import"./index-DwXxsQvB.js";import"./index-DgfI6AGt.js";import"./useTypedPage-hmuARwun.js";import"./bell-5VRgJnzP.js";import"./sheet-1SUjjT9Y.js";import"./users-3SuyoAg3.js";import"./log-out-B525vUfE.js";import"./message-square-32k9udjC.js";import"./file-text-D25AipK4.js";function ve({chat:t}){const{t:r}=G(),u=d.useRef(null),m=d.useRef(null),[i,x]=d.useState([]),{data:o,setData:k,post:B,processing:D,reset:F,errors:q}=P({message:"",attachments:[]});d.useEffect(()=>{z()},[t.messages]);const z=()=>{var s;(s=u.current)==null||s.scrollIntoView({behavior:"smooth"})},f=s=>{if(s.preventDefault(),!o.message.trim()&&i.length===0){p.error(r("Please enter a message or attach a file"));return}const a=new FormData;a.append("message",o.message),i.forEach((c,l)=>{a.append(`attachments[${l}]`,c)}),B(route("customer.communications.chats.messages.store",t.id),{data:a,onSuccess:()=>{F(),x([]),m.current&&(m.current.value=""),p.success(r("Message sent successfully"))},onError:()=>{p.error(r("Failed to send message"))}})},A=s=>{const a=Array.from(s.target.files||[]);x(c=>[...c,...a])},M=s=>{x(a=>a.filter((c,l)=>l!==s))},j=s=>{if(s===0)return"0 Bytes";const a=1024,c=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,l)).toFixed(2))+" "+c[l]},E=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},T=s=>new Date(s).toLocaleString(),g=s=>s.split(" ").map(a=>a[0]).join("").toUpperCase();return e.jsxs(I,{children:[e.jsx(R,{title:`Chat - ${t.title}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(_,{href:route("customer.communications.chats"),children:e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),r("Back to Chats")]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsx(K,{className:E(t.status),children:r(t.status.charAt(0).toUpperCase()+t.status.slice(1))}),e.jsxs("span",{className:"text-sm text-gray-500",children:[r("Created")," ",new Date(t.created_at).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(N,{className:"h-[600px] flex flex-col",children:[e.jsx(v,{className:"border-b",children:e.jsxs(y,{className:"flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),r("Conversation")]})}),e.jsxs(w,{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.messages.map(s=>{var a,c;return e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(b,{className:"h-8 w-8",children:[e.jsx(C,{src:(a=s.user)==null?void 0:a.avatar}),e.jsx(S,{children:s.user?g(s.user.name):"S"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:((c=s.user)==null?void 0:c.name)||r("Support Agent")}),e.jsx("span",{className:"text-xs text-gray-500",children:T(s.created_at)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message}),s.attachments&&s.attachments.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:s.attachments.map(l=>e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-700 rounded p-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:l.file_name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",j(l.file_size),")"]})]}),e.jsx(n,{size:"sm",variant:"ghost",children:e.jsx(H,{className:"h-3 w-3"})})]},l.id))})]})]})]},s.id)}),e.jsx("div",{ref:u})]}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("form",{onSubmit:f,className:"space-y-3",children:[i.length>0&&e.jsx("div",{className:"space-y-2",children:i.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",j(s.size),")"]})]}),e.jsx(n,{type:"button",size:"sm",variant:"ghost",onClick:()=>M(a),children:"Ã—"})]},a))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(L,{value:o.message,onChange:s=>k("message",s.target.value),placeholder:r("Type your message..."),className:"flex-1 min-h-[60px]",onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),f(s))}}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>{var s;return(s=m.current)==null?void 0:s.click()},children:e.jsx(h,{className:"h-4 w-4"})}),e.jsx(n,{type:"submit",size:"sm",disabled:D||!o.message.trim()&&i.length===0,children:e.jsx(V,{className:"h-4 w-4"})})]})]}),e.jsx("input",{ref:m,type:"file",multiple:!0,onChange:A,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif"})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(N,{children:[e.jsx(v,{children:e.jsx(y,{children:r("Participants")})}),e.jsx(w,{className:"space-y-3",children:t.participants.map(s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(b,{className:"h-8 w-8",children:[e.jsx(C,{src:s.user.avatar}),e.jsx(S,{children:g(s.user.name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.user.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.user.email})]})]},s.id))})]})})]})]})]})}export{ve as default};
