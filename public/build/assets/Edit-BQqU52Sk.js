import{r as D,G as O,j as e,S as R,x as $}from"./app-BMIA6nir.js";import{A as G}from"./AppLayout-DbMk6clK.js";import{C as x,a as h,b as j,c as f,d as H}from"./card-BAsSN-2Z.js";import{B as _}from"./createLucideIcon-Cg8jdX0w.js";import{I as u}from"./input-Bg5GDATO.js";import{L as r}from"./label-CM6YsqH1.js";import{T as q}from"./textarea-CP26afIU.js";import{S as v,a as g,b as N,c as C,d as b}from"./select-B6KOX9nY.js";import{u as Q}from"./useTranslate-ER5gAOX6.js";import{t as A}from"./index-Dj2TB_RL.js";import{A as J}from"./arrow-left-UX2kDF52.js";import{F as K}from"./file-text-D25AipK4.js";import{U as M}from"./x-C3KwZK3B.js";import{C as W}from"./calculator-DwuSx6in.js";import{T as X}from"./trash-2-DZc0jDKK.js";import{P as Y}from"./plus-BjPf5uI-.js";import{D as Z}from"./dollar-sign-Cli0KufN.js";import"./useTypedPage-hmuARwun.js";import"./sheet-1SUjjT9Y.js";import"./index-BN56TOeV.js";import"./index-DdwO_6Rs.js";import"./index-DgfI6AGt.js";import"./index-BeGDJhOY.js";import"./index-DwXxsQvB.js";import"./AppProvider-NPNBF0OW.js";import"./users-3SuyoAg3.js";import"./message-square-32k9udjC.js";import"./message-circle-CVsRMw7b.js";import"./NotificationComponent-CHA3vjZG.js";import"./bell-5VRgJnzP.js";import"./trending-up-00s2SIxN.js";import"./smartphone-BqGcJ2Wh.js";import"./shield-DwKJ9Ble.js";import"./building-DIkCZBBP.js";import"./ticket-B_Ks_Sjf.js";import"./book-open-DEtrBf1m.js";import"./image-Ct2miMof.js";import"./calendar-DTsvo4Hi.js";import"./clock-BTinGqFV.js";import"./graduation-cap-leaforsl.js";import"./brain-D-NomhzH.js";import"./user-cog-hTW3YbTW.js";import"./key-Qw2I2-NE.js";import"./bot-COuCQh0r.js";import"./globe-S29F6yCY.js";import"./share-2-cOWypco3.js";import"./chevron-down-CrO8JO_i.js";import"./log-out-B525vUfE.js";import"./index-BDIc0y8N.js";import"./index-DTi2vEM4.js";function We({invoice:n,clients:E,leads:L,currencies:U,statuses:k}){const{t}=Q(),[d,I]=D.useState(n.items||[{description:"",quantity:1,unit_price:0,total_price:0}]),{data:i,setData:c,put:V,processing:w,errors:l}=O({billable_type:n.billable_type,billable_id:n.billable_id.toString(),issue_date:n.issue_date,due_date:n.due_date,currency:n.currency,status:n.status,notes:n.notes||"",terms:n.terms||"",tax_rate:n.tax_amount>0?n.tax_amount/n.subtotal*100:0,discount_amount:n.discount_amount||0,items:d});D.useEffect(()=>{c("items",d)},[d]);const P=()=>{I([...d,{description:"",quantity:1,unit_price:0,total_price:0}])},B=s=>{if(d.length>1){const a=d.filter((o,m)=>m!==s);I(a)}},S=(s,a,o)=>{const m=[...d];m[s]={...m[s],[a]:o},(a==="quantity"||a==="unit_price")&&(m[s].total_price=m[s].quantity*m[s].unit_price),I(m)},y=()=>d.reduce((s,a)=>s+a.total_price,0),F=()=>y()*i.tax_rate/100,T=()=>y()+F()-i.discount_amount,z=s=>{s.preventDefault();const a={...i,items:d,subtotal:y(),tax_amount:F(),total_amount:T()};V(route("finance.invoices.update",n.id),{data:a,onSuccess:()=>{A.success(t("finance.invoice_updated","Invoice updated successfully"))},onError:()=>{A.error(t("common.error_occurred","An error occurred"))}})},p=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:i.currency}).format(s);return e.jsxs(G,{title:`${t("common.edit","Edit")} ${t("finance.invoice","Invoice")} ${n.invoice_number}`,breadcrumbs:[{label:t("finance.title","Finance"),href:"/finance"},{label:t("finance.invoices","Invoices"),href:"/finance/invoices"},{label:n.invoice_number,href:`/finance/invoices/${n.id}`},{label:t("common.edit","Edit")}],children:[e.jsx(R,{title:`${t("common.edit","Edit")} ${t("finance.invoice","Invoice")} ${n.invoice_number}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs($,{href:route("finance.invoices.show",n.id),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),t("common.back","Back")]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:[t("common.edit","Edit")," ",t("finance.invoice","Invoice")," ",n.invoice_number]}),e.jsx("p",{className:"text-muted-foreground",children:t("finance.edit_invoice_description","Update invoice details and items")})]})]}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),t("finance.invoice_details","Invoice Details")]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"issue_date",children:[t("finance.issue_date","Issue Date")," *"]}),e.jsx(u,{id:"issue_date",type:"date",value:i.issue_date,onChange:s=>c("issue_date",s.target.value),required:!0}),l.issue_date&&e.jsx("p",{className:"text-sm text-red-600",children:l.issue_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"due_date",children:[t("finance.due_date","Due Date")," *"]}),e.jsx(u,{id:"due_date",type:"date",value:i.due_date,onChange:s=>c("due_date",s.target.value),required:!0}),l.due_date&&e.jsx("p",{className:"text-sm text-red-600",children:l.due_date})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"currency",children:[t("finance.currency","Currency")," *"]}),e.jsxs(v,{value:i.currency,onValueChange:s=>c("currency",s),children:[e.jsx(g,{children:e.jsx(N,{})}),e.jsx(C,{children:Object.entries(U).map(([s,a])=>e.jsxs(b,{value:s,children:[s," - ",a]},s))})]}),l.currency&&e.jsx("p",{className:"text-sm text-red-600",children:l.currency})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"status",children:[t("common.status","Status")," *"]}),e.jsxs(v,{value:i.status,onValueChange:s=>c("status",s),children:[e.jsx(g,{children:e.jsx(N,{})}),e.jsx(C,{children:Object.entries(k).map(([s,a])=>e.jsx(b,{value:s,children:a},s))})]}),l.status&&e.jsx("p",{className:"text-sm text-red-600",children:l.status})]})]})]})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),t("finance.client_details","Client Details")]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"billable_type",children:[t("finance.client_type","Client Type")," *"]}),e.jsxs(v,{value:i.billable_type,onValueChange:s=>{c("billable_type",s),c("billable_id","")},children:[e.jsx(g,{children:e.jsx(N,{placeholder:t("finance.select_client_type","Select client type")})}),e.jsxs(C,{children:[e.jsx(b,{value:"client",children:t("crm.client","Client")}),e.jsx(b,{value:"lead",children:t("crm.lead","Lead")})]})]}),l.billable_type&&e.jsx("p",{className:"text-sm text-red-600",children:l.billable_type})]}),i.billable_type&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"billable_id",children:[i.billable_type==="client"?t("crm.client","Client"):t("crm.lead","Lead")," *"]}),e.jsxs(v,{value:i.billable_id,onValueChange:s=>c("billable_id",s),children:[e.jsx(g,{children:e.jsx(N,{placeholder:`Select ${i.billable_type}`})}),e.jsx(C,{children:(i.billable_type==="client"?E:L).map(s=>e.jsx(b,{value:s.id.toString(),children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})},s.id))})]}),l.billable_id&&e.jsx("p",{className:"text-sm text-red-600",children:l.billable_id})]})]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),t("finance.invoice_items","Invoice Items")]}),e.jsx(H,{children:t("finance.add_items_description","Add items or services to your invoice")})]}),e.jsxs(f,{className:"space-y-4",children:[d.map((s,a)=>e.jsxs("div",{className:"grid gap-4 md:grid-cols-12 items-end p-4 border rounded-lg",children:[e.jsxs("div",{className:"md:col-span-5 space-y-2",children:[e.jsx(r,{htmlFor:`description-${a}`,children:t("finance.description","Description")}),e.jsx(u,{id:`description-${a}`,placeholder:t("finance.item_description","Item description"),value:s.description,onChange:o=>S(a,"description",o.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(r,{htmlFor:`quantity-${a}`,children:t("finance.quantity","Quantity")}),e.jsx(u,{id:`quantity-${a}`,type:"number",min:"1",step:"1",value:s.quantity,onChange:o=>S(a,"quantity",parseInt(o.target.value)||1)})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(r,{htmlFor:`unit_price-${a}`,children:t("finance.unit_price","Unit Price")}),e.jsx(u,{id:`unit_price-${a}`,type:"number",min:"0",step:"0.01",value:s.unit_price,onChange:o=>S(a,"unit_price",parseFloat(o.target.value)||0)})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(r,{children:t("finance.total","Total")}),e.jsx("div",{className:"h-10 px-3 py-2 border rounded-md bg-muted flex items-center",children:p(s.total_price)})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:()=>B(a),disabled:d.length===1,children:e.jsx(X,{className:"h-4 w-4"})})})]},a)),e.jsxs(_,{type:"button",variant:"outline",onClick:P,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("finance.add_item","Add Item")]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(j,{children:t("finance.additional_information","Additional Information")})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"notes",children:t("finance.notes","Notes")}),e.jsx(q,{id:"notes",placeholder:t("finance.invoice_notes_placeholder","Add any notes for the client..."),value:i.notes,onChange:s=>c("notes",s.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"terms",children:t("finance.terms","Terms & Conditions")}),e.jsx(q,{id:"terms",placeholder:t("finance.terms_placeholder","Payment terms and conditions..."),value:i.terms,onChange:s=>c("terms",s.target.value),rows:3})]})]})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),t("finance.invoice_totals","Invoice Totals")]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"tax_rate",children:t("finance.tax_rate","Tax Rate (%)")}),e.jsx(u,{id:"tax_rate",type:"number",min:"0",max:"100",step:"0.01",value:i.tax_rate,onChange:s=>c("tax_rate",parseFloat(s.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"discount_amount",children:t("finance.discount_amount","Discount Amount")}),e.jsx(u,{id:"discount_amount",type:"number",min:"0",step:"0.01",value:i.discount_amount,onChange:s=>c("discount_amount",parseFloat(s.target.value)||0)})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t("finance.subtotal","Subtotal"),":"]}),e.jsx("span",{className:"font-medium",children:p(y())})]}),i.tax_rate>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t("finance.tax","Tax")," (",i.tax_rate,"%):"]}),e.jsx("span",{className:"font-medium",children:p(F())})]}),i.discount_amount>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t("finance.discount","Discount"),":"]}),e.jsxs("span",{className:"font-medium",children:["-",p(i.discount_amount)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[e.jsxs("span",{children:[t("finance.total","Total"),":"]}),e.jsx("span",{children:p(T())})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(_,{type:"button",variant:"outline",asChild:!0,children:e.jsx($,{href:route("finance.invoices.show",n.id),children:t("common.cancel","Cancel")})}),e.jsx(_,{type:"submit",disabled:w,children:w?t("common.saving","Saving..."):t("finance.update_invoice","Update Invoice")})]})]})]})]})}export{We as default};
