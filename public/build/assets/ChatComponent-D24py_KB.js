import{r as c,G as y,j as s,R as b}from"./app-BMIA6nir.js";import{B as E}from"./createLucideIcon-Cg8jdX0w.js";import{C as S,a as D,b as $,c as A,e as R}from"./card-BAsSN-2Z.js";import{T as B}from"./textarea-CP26afIU.js";import{A as L,b as T,a as F}from"./avatar-DdiG0YBt.js";import{B as U}from"./x-C3KwZK3B.js";import{u as M}from"./useTypedPage-hmuARwun.js";function O({chattableType:o,chattableId:n,recipientId:h,initialMessages:f=[]}){const l=M().props.auth.user,[i,u]=c.useState(f),p=c.useRef(null),{data:x,setData:g,post:j,processing:v,reset:w,errors:z}=y({message:"",chattable_type:o,chattable_id:n,recipient_id:h});c.useEffect(()=>{var e;(e=p.current)==null||e.scrollIntoView({behavior:"smooth"})},[i]),c.useEffect(()=>{if(window.Echo){const e=o==="App\\Models\\Client"?`client.${n}`:`lead.${n}`,t=window.Echo.private(e);t.listen(".chat.message",r=>{u(m=>[...m,r])});const a=window.Echo.private(`user.${l.id}`);return a.listen(".chat.message",r=>{r.chattable_type===o&&r.chattable_id===n&&u(m=>[...m,r])}),()=>{t.stopListening(".chat.message"),a.stopListening(".chat.message")}}},[o,n,l]);const N=e=>{e.preventDefault(),j(route("crm.chats.store"),{onSuccess:()=>{w("message")}})},C=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d=e=>new Date(e).toLocaleDateString(),_=e=>e.split(" ").map(t=>t[0]).join("").toUpperCase();return s.jsxs(S,{className:"h-full flex flex-col",children:[s.jsx(D,{className:"pb-3",children:s.jsx($,{children:"Chat"})}),s.jsx(A,{className:"flex-grow overflow-y-auto max-h-[400px] space-y-4",children:i.length===0?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No messages yet. Start the conversation!"}):s.jsxs("div",{className:"space-y-4",children:[i.map((e,t)=>{const a=e.user_id===l.id,r=t===0||d(i[t-1].created_at)!==d(e.created_at);return s.jsxs(b.Fragment,{children:[r&&s.jsx("div",{className:"text-center my-2",children:s.jsx(U,{variant:"outline",className:"bg-muted",children:d(e.created_at)})}),s.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:s.jsxs("div",{className:`flex gap-2 max-w-[80%] ${a?"flex-row-reverse":"flex-row"}`,children:[s.jsxs(L,{className:"h-8 w-8",children:[e.user.profile_photo_url&&s.jsx(T,{src:e.user.profile_photo_url,alt:e.user.name}),s.jsx(F,{children:_(e.user.name)})]}),s.jsxs("div",{children:[s.jsx("div",{className:`rounded-lg p-3 ${a?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.message}),s.jsxs("div",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[s.jsx("span",{children:C(e.created_at)}),a&&s.jsx("span",{children:e.is_read?"✓✓":"✓"})]})]})]})})]},e.id)}),s.jsx("div",{ref:p})]})}),s.jsx(R,{className:"pt-3 border-t",children:s.jsxs("form",{onSubmit:N,className:"w-full flex gap-2",children:[s.jsx(B,{placeholder:"Type your message...",value:x.message,onChange:e=>g("message",e.target.value),className:"flex-grow resize-none",rows:2}),s.jsx(E,{type:"submit",disabled:v||!x.message.trim(),children:"Send"})]})})]})}export{O as C};
