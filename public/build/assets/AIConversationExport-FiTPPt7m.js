import{u as te,r as m,j as e,S as re,A as ie}from"./app-BMIA6nir.js";import{A as ce,C as q}from"./AppLayout-DbMk6clK.js";import{C as n,c as d,a as j,b as v,d as u}from"./card-BAsSN-2Z.js";import{c as $,B as w}from"./createLucideIcon-Cg8jdX0w.js";import{I as S}from"./input-Bg5GDATO.js";import{L as o}from"./label-CM6YsqH1.js";import{S as C}from"./switch-_qD_kSA5.js";import{S as A,a as k,b as I,c as E,d as c}from"./select-B6KOX9nY.js";import{T as le,a as ne,b as F,c as T}from"./tabs-YflTNJKH.js";import{B as g}from"./x-C3KwZK3B.js";import{S as V}from"./separator-DnQonHW9.js";import{t as x}from"./index-Dj2TB_RL.js";import{M as de}from"./message-square-32k9udjC.js";import{B as b}from"./bot-COuCQh0r.js";import{S as oe}from"./sheet-1SUjjT9Y.js";import{D as U}from"./download-CNZP3fGS.js";import{E as f}from"./eye-DdivFxyT.js";import{F as L}from"./file-text-D25AipK4.js";import{B as H}from"./brain-D-NomhzH.js";import{S as X}from"./shield-DwKJ9Ble.js";import{L as M}from"./loader-circle-BUEefOfS.js";import{T as me}from"./trending-up-00s2SIxN.js";import{C as xe}from"./calendar-DTsvo4Hi.js";import{A as he}from"./arrow-left-UX2kDF52.js";import"./useTypedPage-hmuARwun.js";import"./index-BN56TOeV.js";import"./index-DdwO_6Rs.js";import"./index-DgfI6AGt.js";import"./index-BeGDJhOY.js";import"./index-DwXxsQvB.js";import"./AppProvider-NPNBF0OW.js";import"./useTranslate-ER5gAOX6.js";import"./users-3SuyoAg3.js";import"./message-circle-CVsRMw7b.js";import"./NotificationComponent-CHA3vjZG.js";import"./bell-5VRgJnzP.js";import"./dollar-sign-Cli0KufN.js";import"./smartphone-BqGcJ2Wh.js";import"./building-DIkCZBBP.js";import"./ticket-B_Ks_Sjf.js";import"./book-open-DEtrBf1m.js";import"./image-Ct2miMof.js";import"./clock-BTinGqFV.js";import"./graduation-cap-leaforsl.js";import"./user-cog-hTW3YbTW.js";import"./key-Qw2I2-NE.js";import"./plus-BjPf5uI-.js";import"./globe-S29F6yCY.js";import"./share-2-cOWypco3.js";import"./chevron-down-CrO8JO_i.js";import"./log-out-B525vUfE.js";import"./index-BDIc0y8N.js";import"./index-DTi2vEM4.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],J=$("file-json",pe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],K=$("file-spreadsheet",je);function vs({statistics:O}){const N=te(),[Z,Y]=m.useState("export"),[D,P]=m.useState(!1),[y,z]=m.useState(!1),[ve,R]=m.useState(!1),[h,G]=m.useState(null),[t,Q]=m.useState(O),[r,W]=m.useState({format:"json",date_from:"",date_to:"",ai_service:"",min_messages:2,anonymize:!0,include_ip:!1,include_metadata:!0,conversation_outcome:""});m.useEffect(()=>{O||ee()},[]);const ee=async()=>{var s;R(!0);try{const i=await(await fetch(N("crm.ai-conversations.statistics"),{headers:{"X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}})).json();Q(i)}catch{x.error("Failed to load statistics")}finally{R(!1)}},se=async()=>{var s;P(!0);try{const a=await fetch(N("crm.ai-conversations.export"),{method:"POST",headers:{"X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"","Content-Type":"application/json"},body:JSON.stringify(r)});if(a.ok){const i=await a.blob(),_=window.URL.createObjectURL(i),p=document.createElement("a");p.href=_,p.download=`ai_conversations_export_${new Date().toISOString().split("T")[0]}.${r.format}`,document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(_),document.body.removeChild(p),x.success("Export completed successfully!",{description:"Your AI conversation data has been downloaded."})}else{const i=await a.json();x.error("Export failed",{description:i.message||"Please try again."})}}catch{x.error("Export failed",{description:"An unexpected error occurred."})}finally{P(!1)}},B=async()=>{var s;z(!0);try{const a=await fetch(N("crm.ai-conversations.preview"),{method:"POST",headers:{"X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"","Content-Type":"application/json"},body:JSON.stringify(r)});if(a.ok){const i=await a.json();G(i),x.success("Preview loaded successfully")}else x.error("Failed to load preview")}catch{x.error("Failed to load preview")}finally{z(!1)}},l=(s,a)=>{W(i=>({...i,[s]:a}))},ae=s=>{switch(s){case"json":return e.jsx(J,{className:"h-4 w-4"});case"csv":return e.jsx(L,{className:"h-4 w-4"});case"excel":return e.jsx(K,{className:"h-4 w-4"});case"ml-training":return e.jsx(H,{className:"h-4 w-4"});default:return e.jsx(L,{className:"h-4 w-4"})}};return e.jsxs(ce,{title:"AI Conversation Export",renderHeader:()=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>ie.visit(N("settings.advanced")),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Back to Advanced Settings"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-6 w-6 text-purple-600"}),e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"AI Conversation Export"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(g,{variant:"outline",className:"text-orange-600 border-orange-600",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Admin Only"]})})]}),children:[e.jsx(re,{title:"AI Conversation Export"}),e.jsxs("div",{className:"space-y-6",children:[t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total AI Conversations"}),e.jsx("p",{className:"text-2xl font-bold",children:t.total_ai_conversations})]}),e.jsx(de,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"AI Responses"}),e.jsx("p",{className:"text-2xl font-bold",children:t.ai_response_effectiveness.total_ai_responses})]}),e.jsx(b,{className:"h-8 w-8 text-purple-600"})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg. Conversation Length"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(t.average_conversation_length)})]}),e.jsx(q,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(n,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"AI Services"}),e.jsx("p",{className:"text-2xl font-bold",children:Object.keys(t.ai_services_breakdown).length})]}),e.jsx(oe,{className:"h-8 w-8 text-orange-600"})]})})})]}),e.jsxs(le,{value:Z,onValueChange:Y,className:"space-y-6",children:[e.jsxs(ne,{className:"grid w-full grid-cols-3",children:[e.jsxs(F,{value:"export",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Export Data"]}),e.jsxs(F,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(F,{value:"preview",className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Preview"]})]}),e.jsx(T,{value:"export",children:e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Export AI Conversations"]}),e.jsx(u,{children:"Export AI conversation data for analysis, machine learning training, or backup purposes. All exports are anonymized by default to protect user privacy."})]}),e.jsxs(d,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"format",children:"Export Format"}),e.jsxs(A,{value:r.format,onValueChange:s=>l("format",s),children:[e.jsx(k,{children:e.jsx(I,{})}),e.jsxs(E,{children:[e.jsx(c,{value:"json",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"JSON (Structured Data)"]})}),e.jsx(c,{value:"csv",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"CSV (Spreadsheet)"]})}),e.jsx(c,{value:"excel",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Excel (XLSX)"]})}),e.jsx(c,{value:"ml-training",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"ML Training Format"]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"date_from",children:"From Date"}),e.jsx(S,{id:"date_from",type:"date",value:r.date_from,onChange:s=>l("date_from",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"date_to",children:"To Date"}),e.jsx(S,{id:"date_to",type:"date",value:r.date_to,onChange:s=>l("date_to",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"ai_service",children:"AI Service"}),e.jsxs(A,{value:r.ai_service,onValueChange:s=>l("ai_service",s),children:[e.jsx(k,{children:e.jsx(I,{placeholder:"All Services"})}),e.jsxs(E,{children:[e.jsx(c,{value:"empty",children:"All Services"}),e.jsx(c,{value:"mistral",children:"Mistral AI"}),e.jsx(c,{value:"openai",children:"OpenAI"}),e.jsx(c,{value:"anthropic",children:"Anthropic"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"min_messages",children:"Minimum Messages"}),e.jsx(S,{id:"min_messages",type:"number",min:"1",max:"100",value:r.min_messages,onChange:s=>l("min_messages",parseInt(s.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"conversation_outcome",children:"Conversation Status"}),e.jsxs(A,{value:r.conversation_outcome,onValueChange:s=>l("conversation_outcome",s),children:[e.jsx(k,{children:e.jsx(I,{placeholder:"All Statuses"})}),e.jsxs(E,{children:[e.jsx(c,{value:"empty",children:"All Statuses"}),e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"archived",children:"Archived"}),e.jsx(c,{value:"resolved",children:"Resolved"})]})]})]})]}),e.jsx(V,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Privacy & Data Options"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{htmlFor:"anonymize",children:"Anonymize Personal Data"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hash names and emails for privacy"})]}),e.jsx(C,{id:"anonymize",checked:r.anonymize,onCheckedChange:s=>l("anonymize",s)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{htmlFor:"include_ip",children:"Include IP Addresses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Include guest IP addresses in export"})]}),e.jsx(C,{id:"include_ip",checked:r.include_ip,onCheckedChange:s=>l("include_ip",s)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{htmlFor:"include_metadata",children:"Include Metadata"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Include AI service and model information"})]}),e.jsx(C,{id:"include_metadata",checked:r.include_metadata,onCheckedChange:s=>l("include_metadata",s)})]})]})]}),e.jsx(V,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(w,{variant:"outline",onClick:B,disabled:y,className:"flex items-center gap-2",children:[y?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsx(f,{className:"h-4 w-4"}),"Preview Data"]}),e.jsxs(w,{onClick:se,disabled:D,className:"flex items-center gap-2",children:[D?e.jsx(M,{className:"h-4 w-4 animate-spin"}):ae(r.format),"Export ",r.format.toUpperCase()]})]})]})]})}),e.jsx(T,{value:"statistics",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"AI Services Breakdown"]}),e.jsx(u,{children:"Distribution of AI responses by service provider"})]}),e.jsx(d,{children:t&&Object.keys(t.ai_services_breakdown).length>0?e.jsx("div",{className:"space-y-4",children:Object.entries(t.ai_services_breakdown).map(([s,a])=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium capitalize",children:s}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a," responses"]})]})]}),e.jsx(g,{variant:"secondary",children:a})]},s))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No AI service data available"})})]}),e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Conversation Outcomes"]}),e.jsx(u,{children:"Status distribution of AI conversations"})]}),e.jsx(d,{children:t&&Object.keys(t.conversation_outcomes).length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(t.conversation_outcomes).map(([s,a])=>e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:a}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s})]},s))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No conversation outcome data available"})})]}),e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Most Active Periods"]}),e.jsx(u,{children:"Days with highest AI conversation activity"})]}),e.jsx(d,{children:t&&t.most_active_periods.length>0?e.jsx("div",{className:"space-y-3",children:t.most_active_periods.slice(0,10).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(g,{variant:"outline",children:["#",a+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:new Date(s.date).toLocaleDateString()}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.count," conversations"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold",children:s.count})})]},s.date))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No activity data available"})})]})]})}),e.jsx(T,{value:"preview",children:e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5"}),"Data Preview"]}),e.jsx(u,{children:"Preview a sample of the export data based on your current filters"})]}),e.jsx(d,{children:h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Conversations"}),e.jsx("p",{className:"text-xl font-bold",children:h.total_conversations})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Preview Sample"}),e.jsx("p",{className:"text-xl font-bold",children:h.preview_data.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Estimated Size"}),e.jsx("p",{className:"text-xl font-bold",children:h.estimated_file_size})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Sample Conversations"}),h.preview_data.slice(0,3).map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"font-medium",children:s.conversation_title}),e.jsx(g,{variant:"outline",children:s.status})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:[e.jsxs("p",{children:["Messages: ",s.conversation_metrics.total_messages]}),e.jsxs("p",{children:["AI Responses: ",s.conversation_metrics.ai_message_count]}),e.jsxs("p",{children:["Services: ",s.ai_services_used.join(", ")]})]}),e.jsxs("div",{className:"space-y-2",children:[s.messages.slice(0,3).map((i,_)=>e.jsxs("div",{className:"flex gap-3 p-2 bg-gray-50 rounded",children:[e.jsx(g,{variant:i.sender_type==="ai"?"default":"secondary",className:"text-xs",children:i.sender_type}),e.jsxs("p",{className:"text-sm flex-1",children:[i.message.substring(0,100),"..."]})]},i.message_id)),s.messages.length>3&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["... and ",s.messages.length-3," more messages"]})]})]},s.conversation_id))]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(f,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No preview data loaded"}),e.jsxs(w,{onClick:B,disabled:y,children:[y?e.jsx(M,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(f,{className:"h-4 w-4 mr-2"}),"Load Preview"]})]})})]})})]})]})]})}export{vs as default};
