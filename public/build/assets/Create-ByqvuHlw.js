import{u as B,r as u,G as R,j as e,S as z,x as A}from"./app-BMIA6nir.js";import{A as G}from"./AppLayout-DbMk6clK.js";import{C as E,a as P,b as X,c as D,d as H}from"./card-BAsSN-2Z.js";import{B as j}from"./createLucideIcon-Cg8jdX0w.js";import{I as x}from"./input-Bg5GDATO.js";import{L as c}from"./label-CM6YsqH1.js";import{T as O}from"./textarea-CP26afIU.js";import{S as _,a as y,b as g,c as N,d}from"./select-B6KOX9nY.js";import{A as q,a as J}from"./alert-CNp8ZuHk.js";import{u as K}from"./useTranslate-ER5gAOX6.js";import{t as I}from"./index-Dj2TB_RL.js";import{A as Q}from"./arrow-left-UX2kDF52.js";import{F as Y}from"./file-text-D25AipK4.js";import{S as ee}from"./smartphone-BqGcJ2Wh.js";import{C as se}from"./NotificationComponent-CHA3vjZG.js";import{S as k}from"./send-C-AP4C9s.js";import{U as ae}from"./x-C3KwZK3B.js";import"./useTypedPage-hmuARwun.js";import"./sheet-1SUjjT9Y.js";import"./index-BN56TOeV.js";import"./index-DdwO_6Rs.js";import"./index-DgfI6AGt.js";import"./index-BeGDJhOY.js";import"./index-DwXxsQvB.js";import"./AppProvider-NPNBF0OW.js";import"./users-3SuyoAg3.js";import"./message-square-32k9udjC.js";import"./message-circle-CVsRMw7b.js";import"./dollar-sign-Cli0KufN.js";import"./trending-up-00s2SIxN.js";import"./shield-DwKJ9Ble.js";import"./building-DIkCZBBP.js";import"./ticket-B_Ks_Sjf.js";import"./book-open-DEtrBf1m.js";import"./image-Ct2miMof.js";import"./calendar-DTsvo4Hi.js";import"./clock-BTinGqFV.js";import"./graduation-cap-leaforsl.js";import"./brain-D-NomhzH.js";import"./user-cog-hTW3YbTW.js";import"./key-Qw2I2-NE.js";import"./plus-BjPf5uI-.js";import"./bot-COuCQh0r.js";import"./globe-S29F6yCY.js";import"./share-2-cOWypco3.js";import"./chevron-down-CrO8JO_i.js";import"./log-out-B525vUfE.js";import"./index-BDIc0y8N.js";import"./index-DTi2vEM4.js";import"./bell-5VRgJnzP.js";function Ye({providers:h,invoice:t}){var S,w,F,T,M;const{t:a}=K(),f=B(),[o,W]=u.useState(null),[b,v]=u.useState(0),{data:n,setData:i,post:L,processing:C,errors:m}=R({provider_id:"",type:"payment",phone_number:"",amount:((S=t==null?void 0:t.total_amount)==null?void 0:S.toString())||"",currency:(t==null?void 0:t.currency)||"ZMW",description:t?`Payment for Invoice ${t.invoice_number}`:"",invoice_id:((w=t==null?void 0:t.id)==null?void 0:w.toString())||"",customer_name:((F=t==null?void 0:t.billable)==null?void 0:F.name)||"",customer_email:((T=t==null?void 0:t.billable)==null?void 0:T.email)||"",callback_url:"",metadata:{}});u.useEffect(()=>{if(n.provider_id){const s=h.find(r=>r.id.toString()===n.provider_id);W(s||null)}},[n.provider_id,h]),u.useEffect(()=>{o&&n.amount&&V()},[o,n.amount]);const V=()=>{if(!o||!n.amount){v(0);return}const s=parseFloat(n.amount),r=o.fee_structure;let l=0;r.fixed_fee&&(l+=r.fixed_fee),r.percentage_fee&&(l+=s*r.percentage_fee/100),r.minimum_fee&&l<r.minimum_fee&&(l=r.minimum_fee),r.maximum_fee&&l>r.maximum_fee&&(l=r.maximum_fee),v(l)},Z=s=>{s.preventDefault(),L(f("finance.momo.store"),{onSuccess:()=>{I.success(a("finance.momo.transaction_initiated","Transaction initiated successfully"))},onError:()=>{I.error(a("common.error_occurred","An error occurred"))}})},p=(s,r="ZMW")=>new Intl.NumberFormat("en-US",{style:"currency",currency:r}).format(s),$=s=>{const r=s.replace(/\D/g,"");return r.startsWith("260")?`+${r}`:r.startsWith("0")?`+260${r.substring(1)}`:r.length===9?`+260${r}`:s},U=s=>{const r=$(s);i("phone_number",r)};return e.jsxs(G,{title:a("finance.momo.new_transaction","New Mobile Money Transaction"),breadcrumbs:[{label:a("finance.title","Finance"),href:"/finance"},{label:a("finance.momo.title","Mobile Money"),href:"/finance/momo"},{label:a("finance.momo.new_transaction","New Transaction")}],children:[e.jsx(z,{title:a("finance.momo.new_transaction","New Mobile Money Transaction")}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{variant:"outline",size:"icon",asChild:!0,children:e.jsx(A,{href:f("finance.momo.index"),children:e.jsx(Q,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:a("finance.momo.new_transaction","New Mobile Money Transaction")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("finance.momo.create_description","Initiate a mobile money payment or payout")})]})]}),t&&e.jsxs(q,{children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsxs(J,{children:[a("finance.momo.invoice_payment","Processing payment for Invoice")," ",e.jsx("strong",{children:t.invoice_number})," - ",p(t.total_amount,t.currency)]})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsx(P,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),a("finance.momo.transaction_details","Transaction Details")]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"provider_id",children:[a("finance.momo.provider","Provider")," *"]}),e.jsxs(_,{value:n.provider_id,onValueChange:s=>i("provider_id",s),children:[e.jsx(y,{children:e.jsx(g,{placeholder:a("finance.momo.select_provider","Select provider")})}),e.jsx(N,{children:h.map(s=>e.jsx(d,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 rounded bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-xs font-medium",children:s.provider_code}),s.display_name]})},s.id))})]}),m.provider_id&&e.jsx("p",{className:"text-sm text-red-600",children:m.provider_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"type",children:[a("finance.momo.transaction_type","Transaction Type")," *"]}),e.jsxs(_,{value:n.type,onValueChange:s=>i("type",s),children:[e.jsx(y,{children:e.jsx(g,{})}),e.jsxs(N,{children:[e.jsx(d,{value:"payment",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),a("finance.momo.type.payment","Payment")]})}),e.jsx(d,{value:"payout",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),a("finance.momo.type.payout","Payout")]})})]})]}),m.type&&e.jsx("p",{className:"text-sm text-red-600",children:m.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"phone_number",children:[a("finance.momo.phone_number","Phone Number")," *"]}),e.jsx(x,{id:"phone_number",type:"tel",placeholder:"+260 97 123 4567",value:n.phone_number,onChange:s=>U(s.target.value),className:m.phone_number?"border-red-500":""}),m.phone_number&&e.jsx("p",{className:"text-sm text-red-600",children:m.phone_number}),e.jsx("p",{className:"text-xs text-gray-500",children:a("finance.momo.phone_format","Format: +260XXXXXXXXX")})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"amount",children:[a("finance.momo.amount","Amount")," *"]}),e.jsx(x,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:n.amount,onChange:s=>i("amount",s.target.value),className:m.amount?"border-red-500":""}),m.amount&&e.jsx("p",{className:"text-sm text-red-600",children:m.amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"currency",children:[a("finance.momo.currency","Currency")," *"]}),e.jsxs(_,{value:n.currency,onValueChange:s=>i("currency",s),children:[e.jsx(y,{children:e.jsx(g,{})}),e.jsx(N,{children:((M=o==null?void 0:o.supported_currencies)==null?void 0:M.map(s=>e.jsx(d,{value:s,children:s},s)))||e.jsx(d,{value:"ZMW",children:"ZMW"})})]}),m.currency&&e.jsx("p",{className:"text-sm text-red-600",children:m.currency})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:a("finance.momo.description","Description")}),e.jsx(O,{id:"description",placeholder:a("finance.momo.description_placeholder","Transaction description..."),value:n.description,onChange:s=>i("description",s.target.value),rows:3}),m.description&&e.jsx("p",{className:"text-sm text-red-600",children:m.description})]})]})]}),e.jsxs(E,{children:[e.jsxs(P,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),a("finance.momo.customer_details","Customer Details")]}),e.jsx(H,{children:a("finance.momo.customer_description","Optional customer information for record keeping")})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"customer_name",children:a("finance.momo.customer_name","Customer Name")}),e.jsx(x,{id:"customer_name",placeholder:a("finance.momo.customer_name_placeholder","Customer name"),value:n.customer_name,onChange:s=>i("customer_name",s.target.value)}),m.customer_name&&e.jsx("p",{className:"text-sm text-red-600",children:m.customer_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"customer_email",children:a("finance.momo.customer_email","Customer Email")}),e.jsx(x,{id:"customer_email",type:"email",placeholder:a("finance.momo.customer_email_placeholder","customer@example.com"),value:n.customer_email,onChange:s=>i("customer_email",s.target.value)}),m.customer_email&&e.jsx("p",{className:"text-sm text-red-600",children:m.customer_email})]}),o&&n.amount&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900 dark:text-gray-100 mb-2",children:a("finance.momo.fee_estimation","Fee Estimation")}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a("finance.momo.transaction_amount","Transaction Amount"),":"]}),e.jsx("span",{className:"font-medium",children:p(parseFloat(n.amount||"0"),n.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a("finance.momo.estimated_fee","Estimated Fee"),":"]}),e.jsx("span",{className:"font-medium",children:p(b,n.currency)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-1 font-medium",children:[e.jsxs("span",{children:[a("finance.momo.total_amount","Total Amount"),":"]}),e.jsx("span",{children:p(parseFloat(n.amount||"0")+b,n.currency)})]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(j,{variant:"outline",asChild:!0,children:e.jsx(A,{href:f("finance.momo.index"),children:a("common.cancel","Cancel")})}),e.jsx(j,{type:"submit",disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),a("finance.momo.processing","Processing...")]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4"}),a("finance.momo.initiate_transaction","Initiate Transaction")]})})]})]})]})]})}export{Ye as default};
