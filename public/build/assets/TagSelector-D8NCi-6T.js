import{r as i,j as s}from"./app-BMIA6nir.js";import{B as g,X as $}from"./x-C3KwZK3B.js";import{a as m,B as A}from"./createLucideIcon-Cg8jdX0w.js";import{I as B}from"./input-Bg5GDATO.js";import{C as F,c as O}from"./card-BAsSN-2Z.js";import{T as z}from"./AppLayout-DbMk6clK.js";import{P as K}from"./plus-BjPf5uI-.js";import{C as P}from"./index-BN56TOeV.js";function Q({availableTags:w,selectedTags:n,onTagsChange:u,placeholder:b="Search or create tags...",className:v,error:f}){const[y,a]=i.useState(!1),[t,d]=i.useState(""),[l,o]=i.useState(-1),j=i.useRef(null),x=i.useRef(null),C=w.filter(e=>!n.some(p=>typeof p=="object"?p.id===e.id:p===e.name)&&e.name.toLowerCase().includes(t.toLowerCase())),N=t.trim()&&!w.some(e=>e.name.toLowerCase()===t.toLowerCase())&&!n.some(e=>typeof e=="string"?e.toLowerCase()===t.toLowerCase():e.name.toLowerCase()===t.toLowerCase()),c=[...C,...N?[{id:-1,name:t.trim(),isNew:!0}]:[]];i.useEffect(()=>{const e=r=>{x.current&&!x.current.contains(r.target)&&(a(!1),d(""),o(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const k=()=>{a(!0)},L=e=>{d(e.target.value),o(-1),a(!0)},S=e=>{if(!y){(e.key==="Enter"||e.key==="ArrowDown")&&(a(!0),e.preventDefault());return}switch(e.key){case"ArrowDown":e.preventDefault(),o(r=>r<c.length-1?r+1:0);break;case"ArrowUp":e.preventDefault(),o(r=>r>0?r-1:c.length-1);break;case"Enter":e.preventDefault(),l>=0&&l<c.length?h(c[l]):N&&h({id:-1,name:t.trim(),isNew:!0});break;case"Escape":a(!1),d(""),o(-1);break}},h=e=>{var r;e.isNew?u([...n,e.name]):u([...n,e]),d(""),o(-1),a(!1),(r=j.current)==null||r.focus()},D=e=>{u(n.filter(r=>typeof r=="string"?r!==e:typeof e=="string"?r.name!==e:r.id!==e.id))},E=e=>typeof e=="string"?"bg-blue-100 text-blue-800":e.color?`bg-${e.color}-100 text-${e.color}-800`:"bg-gray-100 text-gray-800",I=e=>typeof e=="string"?e:e.name;return s.jsxs("div",{className:m("space-y-2",v),ref:x,children:[s.jsxs("div",{className:"relative",children:[s.jsx(B,{ref:j,value:t,onChange:L,onFocus:k,onKeyDown:S,placeholder:b,className:m("pr-10",f&&"border-red-500 focus:border-red-500")}),s.jsx(z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),y&&s.jsx(F,{className:"absolute z-50 w-full mt-1 max-h-60 overflow-auto border shadow-lg",children:s.jsx(O,{className:"p-0",children:c.length===0?s.jsx("div",{className:"p-3 text-sm text-gray-500 text-center",children:t?"No tags found":"Start typing to search or create tags"}):s.jsx("div",{className:"py-1",children:c.map((e,r)=>s.jsxs("div",{className:m("flex items-center justify-between px-3 py-2 cursor-pointer text-sm","hover:bg-gray-100",l===r&&"bg-gray-100"),onClick:()=>h(e),children:[s.jsx("div",{className:"flex items-center gap-2",children:e.isNew?s.jsxs(s.Fragment,{children:[s.jsx(K,{className:"h-4 w-4 text-green-600"}),s.jsxs("span",{children:['Create "',e.name,'"']}),s.jsx(g,{variant:"outline",className:"text-xs",children:"New"})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:m("w-3 h-3 rounded-full",e.color?`bg-${e.color}-500`:"bg-gray-400")}),s.jsx("span",{children:e.name})]})}),l===r&&s.jsx(P,{className:"h-4 w-4 text-gray-600"})]},e.id===-1?`new-${e.name}`:e.id))})})})]}),n.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2",children:n.map((e,r)=>s.jsxs(g,{variant:"secondary",className:m("flex items-center gap-1 pr-1",E(e)),children:[s.jsx("span",{children:I(e)}),s.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>D(e),children:s.jsx($,{className:"h-3 w-3"})})]},typeof e=="string"?`string-${e}`:`tag-${e.id}`))}),f&&s.jsx("p",{className:"text-red-500 text-sm",children:f})]})}export{Q as T};
