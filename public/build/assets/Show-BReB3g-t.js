import{r as m,j as e,S as F,x as b,A as u}from"./app-BMIA6nir.js";import{C as c,c as o,a as U,b as B,d as R}from"./card-BAsSN-2Z.js";import{B as d}from"./createLucideIcon-Cg8jdX0w.js";import{B as C,U as L}from"./x-C3KwZK3B.js";import{T as z}from"./textarea-CP26afIU.js";import{D as I,a as O,b as q,c as x}from"./NotificationComponent-CHA3vjZG.js";import{A as K,a as P}from"./avatar-DdiG0YBt.js";import{A as H,a as X}from"./alert-CNp8ZuHk.js";import{A as Z}from"./AppLayout-DbMk6clK.js";import{u as J}from"./useTranslate-ER5gAOX6.js";import{t as a}from"./index-Dj2TB_RL.js";import{M as h}from"./message-square-32k9udjC.js";import{Z as V}from"./zap-CQoeASxN.js";import{D as $}from"./dollar-sign-Cli0KufN.js";import{C as G}from"./clock-BTinGqFV.js";import{C as Q}from"./copy-XqgUo3o3.js";import{L as W}from"./loader-circle-BUEefOfS.js";import{S as Y}from"./send-C-AP4C9s.js";import{A as g}from"./archive-Bntya-At.js";import{A as ee}from"./arrow-left-UX2kDF52.js";import{E as se}from"./ellipsis-DJ3pNpl6.js";import{S as re}from"./square-pen-CReBrXbl.js";import{A as te}from"./archive-restore-nhW0omiP.js";import{D as ae}from"./download-CNZP3fGS.js";import{T as ie}from"./trash-2-DZc0jDKK.js";import{C as ce}from"./circle-alert-DVIk47WR.js";import{B as oe}from"./bot-COuCQh0r.js";import"./index-BN56TOeV.js";import"./index-DdwO_6Rs.js";import"./index-BeGDJhOY.js";import"./index-DwXxsQvB.js";import"./index-DgfI6AGt.js";import"./useTypedPage-hmuARwun.js";import"./bell-5VRgJnzP.js";import"./sheet-1SUjjT9Y.js";import"./AppProvider-NPNBF0OW.js";import"./users-3SuyoAg3.js";import"./message-circle-CVsRMw7b.js";import"./file-text-D25AipK4.js";import"./trending-up-00s2SIxN.js";import"./smartphone-BqGcJ2Wh.js";import"./shield-DwKJ9Ble.js";import"./building-DIkCZBBP.js";import"./ticket-B_Ks_Sjf.js";import"./book-open-DEtrBf1m.js";import"./image-Ct2miMof.js";import"./calendar-DTsvo4Hi.js";import"./graduation-cap-leaforsl.js";import"./brain-D-NomhzH.js";import"./user-cog-hTW3YbTW.js";import"./key-Qw2I2-NE.js";import"./plus-BjPf5uI-.js";import"./globe-S29F6yCY.js";import"./share-2-cOWypco3.js";import"./chevron-down-CrO8JO_i.js";import"./log-out-B525vUfE.js";function ms({conversation:r}){const{t}=J(),[n,f]=m.useState(""),[p,N]=m.useState(!1),y=m.useRef(null),S=()=>{var s;(s=y.current)==null||s.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{S()},[r.messages]);const w=async()=>{var s;if(!(!n.trim()||p)){N(!0);try{const l=await(await fetch(route("ai.conversations.messages.store",r.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({role:"user",content:n})})).json();l.success?(f(""),u.reload({only:["conversation"]}),a.success(t("Message sent successfully"))):a.error(l.message||t("Failed to send message"))}catch{a.error(t("Failed to send message"))}finally{N(!1)}}},A=async()=>{var i;const s=r.is_archived?"ai.conversations.unarchive":"ai.conversations.archive";try{const j=await(await fetch(route(s,r.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""}})).json();j.success?(a.success(j.message),u.reload()):a.error(j.message)}catch{a.error("Failed to update conversation")}},D=()=>{confirm(t("Are you sure you want to delete this conversation?"))&&u.delete(route("ai.conversations.destroy",r.id),{onSuccess:()=>a.success(t("Conversation deleted successfully")),onError:()=>a.error(t("Failed to delete conversation"))})},T=s=>{navigator.clipboard.writeText(s),a.success(t("Message copied to clipboard"))},v=s=>new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),_=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:4}).format(s),M=s=>({crm:"bg-blue-100 text-blue-800",finance:"bg-green-100 text-green-800",support:"bg-orange-100 text-orange-800",general:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",E=s=>{switch(s){case"user":return e.jsx(L,{className:"h-4 w-4 text-blue-600"});case"assistant":return e.jsx(oe,{className:"h-4 w-4 text-green-600"});case"system":return e.jsx(ce,{className:"h-4 w-4 text-orange-600"});default:return e.jsx(h,{className:"h-4 w-4 text-gray-600"})}},k=s=>{switch(s){case"user":return"bg-blue-50 border-blue-200";case"assistant":return"bg-green-50 border-green-200";case"system":return"bg-orange-50 border-orange-200";default:return"bg-gray-50 border-gray-200"}};return e.jsxs(Z,{title:r.title,renderHeader:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(b,{href:route("ai.conversations.index"),children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),t("Back to Conversations")]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:r.title}),r.is_archived&&e.jsxs(C,{variant:"secondary",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),t("Archived")]}),r.context_type&&e.jsx(C,{className:M(r.context_type),children:r.context_type.toUpperCase()})]}),e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:[r.user.name," â€¢ ",r.ai_model.name]})]})]}),e.jsxs(I,{children:[e.jsx(O,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",children:e.jsx(se,{className:"h-4 w-4"})})}),e.jsxs(q,{align:"end",children:[e.jsx(x,{asChild:!0,children:e.jsxs(b,{href:route("ai.conversations.edit",r.id),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),t("Edit")]})}),e.jsx(x,{onClick:A,children:r.is_archived?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),t("Unarchive")]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),t("Archive")]})}),e.jsxs(x,{onClick:()=>window.print(),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),t("Export")]}),e.jsxs(x,{onClick:D,className:"text-red-600",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),t("Delete")]})]})]})]}),children:[e.jsx(F,{title:r.title}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.message_count}),e.jsx("div",{className:"text-sm text-gray-600",children:t("Messages")})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.total_tokens.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:t("Tokens")})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:_(r.total_cost)}),e.jsx("div",{className:"text-sm text-gray-600",children:t("Cost")})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:v(r.last_message_at)}),e.jsx("div",{className:"text-sm text-gray-600",children:t("Last Message")})]})]})})})]}),e.jsxs(c,{children:[e.jsxs(U,{children:[e.jsxs(B,{className:"flex items-center",children:[e.jsx(h,{className:"h-5 w-5 mr-2"}),t("Conversation")]}),e.jsxs(R,{children:[t("AI Model"),": ",r.ai_model.name," (",r.ai_model.service.name,")"]})]}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4 max-h-[500px] overflow-y-auto",children:[r.messages.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(h,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:t("No messages yet. Start the conversation below.")})]}):r.messages.map((s,i)=>e.jsxs("div",{className:`p-4 rounded-lg border ${k(s.role)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[E(s.role),e.jsx("span",{className:"font-medium capitalize",children:s.role}),e.jsx("span",{className:"text-xs text-gray-500",children:v(s.timestamp)})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>T(s.content),children:e.jsx(Q,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.content})})]},i)),e.jsx("div",{ref:y})]})})]}),!r.is_archived&&e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(K,{className:"h-8 w-8",children:e.jsx(P,{children:r.user.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(z,{value:n,onChange:s=>f(s.target.value),placeholder:t("Type your message..."),rows:3,className:"resize-none",onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),w())}}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:t("Press Enter to send, Shift+Enter for new line")}),e.jsxs(d,{onClick:w,disabled:!n.trim()||p,size:"sm",children:[p?e.jsx(W,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("Send")]})]})]})]})})}),r.is_archived&&e.jsxs(H,{children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(X,{children:t("This conversation is archived. Unarchive it to continue messaging.")})]})]})})]})}export{ms as default};
