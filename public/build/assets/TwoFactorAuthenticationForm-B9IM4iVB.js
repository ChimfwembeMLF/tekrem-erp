import{u as B,r as a,j as e,k as m,G as Q,N as k}from"./app-BMIA6nir.js";import{D as N,T as A,I as D,a as j,c as g,A as L}from"./SecondaryButton-CpjXw7yt.js";import{P as S}from"./PrimaryButton-DpJmRNkC.js";import{D as Y}from"./DangerButton-Dwjq3RFS.js";import{I as q}from"./InputLabel-BJTiKGWD.js";import{u as G}from"./useTypedPage-hmuARwun.js";import"./transition-Dyv_LKQb.js";import"./with-selector-CvGlte-K.js";function u({title:v="Confirm Password",content:C="For your security, please confirm your password to continue.",button:c="Confirm",onConfirm:h,children:i}){const f=B(),[w,p]=a.useState(!1),[s,l]=a.useState({password:"",error:"",processing:!1}),t=a.useRef(null);function x(){m.get(f("password.confirmation")).then(o=>{o.data.confirmed?h():(p(!0),setTimeout(()=>{var n;return(n=t.current)==null?void 0:n.focus()},250))})}function y(){l({...s,processing:!0}),m.post(f("password.confirm"),{password:s.password}).then(()=>{d(),setTimeout(()=>h(),250)}).catch(o=>{var n;l({...s,processing:!1,error:o.response.data.errors.password[0]}),(n=t.current)==null||n.focus()})}function d(){p(!1),l({processing:!1,password:"",error:""})}return e.jsxs("span",{children:[e.jsx("span",{onClick:x,children:i}),e.jsxs(N,{isOpen:w,onClose:d,children:[e.jsxs(N.Content,{title:v,children:[C,e.jsxs("div",{className:"mt-4",children:[e.jsx(A,{ref:t,type:"password",className:"mt-1 block w-3/4",placeholder:"Password",value:s.password,onChange:o=>l({...s,password:o.currentTarget.value})}),e.jsx(D,{message:s.error,className:"mt-2"})]})]}),e.jsxs(N.Footer,{children:[e.jsx(j,{onClick:d,children:"Cancel"}),e.jsx(S,{className:g("ml-2",{"opacity-25":s.processing}),onClick:y,disabled:s.processing,children:c})]})]})]})}function Z({requiresConfirmation:v}){var F,P,R;const C=G(),[c,h]=a.useState(!1),[i,f]=a.useState(!1),[w,p]=a.useState(null),[s,l]=a.useState([]),[t,x]=a.useState(!1),[y,d]=a.useState(null),o=Q({code:""}),n=!c&&((R=(P=(F=C.props)==null?void 0:F.auth)==null?void 0:P.user)==null?void 0:R.two_factor_enabled);function I(){h(!0),k.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess(){return Promise.all([K(),E(),b()])},onFinish(){h(!1),x(v)}})}function E(){return m.get("/user/two-factor-secret-key").then(r=>{d(r.data.secretKey)})}function _(){o.post("/user/confirmed-two-factor-authentication",{preserveScroll:!0,preserveState:!0,errorBag:"confirmTwoFactorAuthentication",onSuccess:()=>{x(!1),p(null),d(null)}})}function K(){return m.get("/user/two-factor-qr-code").then(r=>{p(r.data.svg)})}function b(){return m.get("/user/two-factor-recovery-codes").then(r=>{l(r.data)})}function M(){m.post("/user/two-factor-recovery-codes").then(()=>{b()})}function T(){f(!0),k.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess(){f(!1),x(!1)}})}return e.jsxs(L,{title:"Two Factor Authentication",description:"Add additional security to your account using two factor authentication.",children:[n&&!t?e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"You have enabled two factor authentication."}):t?e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Finish enabling two factor authentication."}):e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"You have not enabled two factor authentication."}),e.jsx("div",{className:"mt-3 max-w-xl text-sm text-gray-600",children:e.jsx("p",{children:"When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application."})}),n||t?e.jsxs("div",{children:[w?e.jsxs("div",{children:[e.jsx("div",{className:"mt-4 max-w-xl text-sm text-gray-600",children:t?e.jsx("p",{className:"font-semibold",children:"To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code."}):e.jsx("p",{children:"Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key."})}),e.jsx("div",{className:"mt-4",dangerouslySetInnerHTML:{__html:w||""}}),y&&e.jsx("div",{className:"mt-4 max-w-xl text-sm text-gray-600",children:e.jsxs("p",{className:"font-semibold",children:["Setup Key:"," ",e.jsx("span",{dangerouslySetInnerHTML:{__html:y||""}})]})}),t&&e.jsxs("div",{className:"mt-4",children:[e.jsx(q,{htmlFor:"code",value:"Code"}),e.jsx(A,{id:"code",type:"text",name:"code",className:"block mt-1 w-1/2",inputMode:"numeric",autoFocus:!0,autoComplete:"one-time-code",value:o.data.code,onChange:r=>o.setData("code",r.currentTarget.value)}),e.jsx(D,{message:o.errors.code,className:"mt-2"})]})]}):null,s.length>0&&!t?e.jsxs("div",{children:[e.jsx("div",{className:"mt-4 max-w-xl text-sm text-gray-600",children:e.jsx("p",{className:"font-semibold",children:"Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost."})}),e.jsx("div",{className:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg",children:s.map(r=>e.jsx("div",{children:r},r))})]}):null]}):null,e.jsx("div",{className:"mt-5",children:n||t?e.jsxs("div",{children:[t?e.jsx(u,{onConfirm:_,children:e.jsx(S,{className:g("mr-3",{"opacity-25":c}),disabled:c,children:"Confirm"})}):null,s.length>0&&!t?e.jsx(u,{onConfirm:M,children:e.jsx(j,{className:"mr-3",children:"Regenerate Recovery Codes"})}):null,s.length===0&&!t?e.jsx(u,{onConfirm:b,children:e.jsx(j,{className:"mr-3",children:"Show Recovery Codes"})}):null,t?e.jsx(u,{onConfirm:T,children:e.jsx(j,{className:g("mr-3",{"opacity-25":i}),disabled:i,children:"Cancel"})}):e.jsx(u,{onConfirm:T,children:e.jsx(Y,{className:g({"opacity-25":i}),disabled:i,children:"Disable"})})]}):e.jsx("div",{children:e.jsx(u,{onConfirm:I,children:e.jsx(S,{type:"button",className:g({"opacity-25":c}),disabled:c,children:"Enable"})})})})]})}export{Z as default};
