import{r as h,R as E,j as e,u as G,G as J,S as V,x as I,A as v}from"./app-BMIA6nir.js";import{A as W}from"./AppLayout-DbMk6clK.js";import{C as y,a as _,b as w,d as Y,c as b}from"./card-BAsSN-2Z.js";import{B as c}from"./createLucideIcon-Cg8jdX0w.js";import{B as d}from"./x-C3KwZK3B.js";import{A as H,a as Q}from"./alert-CNp8ZuHk.js";import{S as U}from"./separator-DnQonHW9.js";import{u as $}from"./useTranslate-ER5gAOX6.js";import{B as Z}from"./brain-D-NomhzH.js";import{L as z}from"./loader-circle-BUEefOfS.js";import{R as ee}from"./refresh-cw-CkrxGXg9.js";import{T as A}from"./triangle-alert-BWIpgUmg.js";import{L as se}from"./lightbulb-COB8R_XU.js";import{T as te}from"./target-DIhftedx.js";import{B as re}from"./book-open-DEtrBf1m.js";import{F as ae}from"./file-text-D25AipK4.js";import{T as L}from"./thumbs-up-BgoIjls2.js";import{T as q}from"./thumbs-down-SVKOui9E.js";import{C as ne}from"./circle-check-big-DCsv6rXk.js";import{T as ie}from"./textarea-CP26afIU.js";import{S as oe,a as le,b as ce,c as de,d as O}from"./select-B6KOX9nY.js";import{A as me,a as pe}from"./avatar-DdiG0YBt.js";import{A as ue}from"./arrow-left-UX2kDF52.js";import{B as xe}from"./bot-COuCQh0r.js";import{S as he}from"./square-pen-CReBrXbl.js";import{M as P}from"./message-square-32k9udjC.js";import{C as ge}from"./clock-BTinGqFV.js";import{P as je}from"./paperclip-BkqMpcId.js";import{S as fe}from"./send-C-AP4C9s.js";import{R as Ne}from"./rotate-ccw-BcdmK91W.js";import{C as ve}from"./circle-x-D-Fm_LhT.js";import"./useTypedPage-hmuARwun.js";import"./sheet-1SUjjT9Y.js";import"./index-BN56TOeV.js";import"./index-DdwO_6Rs.js";import"./index-DgfI6AGt.js";import"./index-BeGDJhOY.js";import"./index-DwXxsQvB.js";import"./AppProvider-NPNBF0OW.js";import"./index-Dj2TB_RL.js";import"./users-3SuyoAg3.js";import"./message-circle-CVsRMw7b.js";import"./NotificationComponent-CHA3vjZG.js";import"./bell-5VRgJnzP.js";import"./dollar-sign-Cli0KufN.js";import"./trending-up-00s2SIxN.js";import"./smartphone-BqGcJ2Wh.js";import"./shield-DwKJ9Ble.js";import"./building-DIkCZBBP.js";import"./ticket-B_Ks_Sjf.js";import"./image-Ct2miMof.js";import"./calendar-DTsvo4Hi.js";import"./graduation-cap-leaforsl.js";import"./user-cog-hTW3YbTW.js";import"./key-Qw2I2-NE.js";import"./plus-BjPf5uI-.js";import"./globe-S29F6yCY.js";import"./share-2-cOWypco3.js";import"./chevron-down-CrO8JO_i.js";import"./log-out-B525vUfE.js";import"./index-BDIc0y8N.js";import"./index-DTi2vEM4.js";function ye({ticketId:t,onApplySuggestion:p,className:g=""}){const{t:s}=$(),[n,T]=h.useState(null),[j,k]=h.useState(!1),[u,o]=h.useState(null),[m,F]=h.useState(null),f=async()=>{var a;k(!0),o(null);try{const l=await fetch(`/support/ai/tickets/${t}/suggestions`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""}});if(!l.ok)throw new Error("Failed to fetch AI suggestions");const N=await l.json();T(N)}catch(l){o(l instanceof Error?l.message:"An error occurred")}finally{k(!1)}},S=async a=>{var l;try{await fetch(`/support/ai/tickets/${t}/suggestions/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""},body:JSON.stringify({helpful:a,suggestion_id:n?"ai_suggestion":null})}),F(a?"helpful":"not_helpful")}catch(N){console.error("Failed to submit feedback:",N)}},C=a=>a>=80?"text-green-600 bg-green-100":a>=60?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",D=a=>a>=80?ne:a>=60?A:A;return E.useEffect(()=>{f()},[t]),e.jsxs(y,{className:g,children:[e.jsxs(_,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-primary"}),e.jsx(w,{children:s("support.ai_suggestions","AI Suggestions")})]}),e.jsx(c,{variant:"outline",size:"sm",onClick:f,disabled:j,children:j?e.jsx(z,{className:"h-4 w-4 animate-spin"}):e.jsx(ee,{className:"h-4 w-4"})})]}),e.jsx(Y,{children:s("support.ai_suggestions_description","AI-powered resolution suggestions and recommendations")})]}),e.jsxs(b,{children:[j&&!n&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(z,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:s("support.analyzing_ticket","Analyzing ticket...")})]}),u&&e.jsxs(H,{variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(Q,{children:u})]}),n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s("support.confidence_score","Confidence Score")}),e.jsxs(d,{className:C(n.confidence),variant:"secondary",children:[E.createElement(D(n.confidence),{className:"h-3 w-3 mr-1"}),n.confidence,"%"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(se,{className:"h-4 w-4 text-yellow-500"}),e.jsx("h4",{className:"font-medium",children:s("support.resolution_suggestions","Resolution Suggestions")})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"whitespace-pre-wrap text-sm",children:n.suggestions}),p&&e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx(c,{size:"sm",onClick:()=>p(n.suggestions),children:s("support.apply_suggestion","Apply Suggestion")})})]})]}),n.similar_tickets.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(te,{className:"h-4 w-4 text-blue-500"}),e.jsx("h4",{className:"font-medium",children:s("support.similar_tickets","Similar Tickets")})]}),e.jsx("div",{className:"space-y-2",children:n.similar_tickets.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:["#",a.ticket_number]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.title})]}),e.jsx(d,{variant:"outline",children:a.status})]},a.id))})]}),n.recommended_articles.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(re,{className:"h-4 w-4 text-green-500"}),e.jsx("h4",{className:"font-medium",children:s("support.recommended_articles","Recommended Articles")})]}),e.jsx("div",{className:"space-y-2",children:n.recommended_articles.map(a=>e.jsx("div",{className:"p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:a.title}),a.excerpt&&e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:a.excerpt})]})]})},a.id))})]}),e.jsx(U,{}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s("support.was_this_helpful","Was this helpful?")}),m===null?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>S(!0),children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),s("common.yes","Yes")]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>S(!1),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),s("common.no","No")]})]}):e.jsx(d,{variant:"secondary",children:m==="helpful"?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),s("support.marked_helpful","Marked as helpful")]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),s("support.marked_not_helpful","Marked as not helpful")]})})]})})]})]})]})}function Ds({ticket:t,users:p,comments:g}){var B;const{t:s}=$(),n=G(),[T,j]=h.useState(!1),[k,u]=h.useState(""),{data:o,setData:m,post:F,processing:f,reset:S}=J({content:"",is_internal:!1,is_solution:!1,time_spent_minutes:"",attachments:[]}),C=r=>{switch(r){case"open":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-orange-100 text-orange-800";case"resolved":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},D=r=>{switch(r){case"low":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"high":return"bg-orange-100 text-orange-800";case"urgent":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},a=()=>t.due_date&&new Date(t.due_date)<new Date&&!["resolved","closed"].includes(t.status),l=r=>{r.preventDefault();const i=new FormData;i.append("content",o.content),i.append("is_internal",o.is_internal?"1":"0"),i.append("is_solution",o.is_solution?"1":"0"),o.time_spent_minutes&&i.append("time_spent_minutes",o.time_spent_minutes),o.attachments.forEach((x,K)=>{i.append(`attachments[${K}]`,x)}),v.post(n("support.tickets.comments.store",t.id),i,{forceFormData:!0,onSuccess:()=>{S(),v.reload()}})},N=r=>{v.post(n("support.tickets.assign",t.id),{assigned_to:r})},R=r=>{if(r==="closed"){const i=prompt(s("support.close_reason","Please provide a reason for closing this ticket:"));i&&v.post(n("support.tickets.close",t.id),{resolution_notes:i})}else if(r==="reopen"){const i=prompt(s("support.reopen_reason","Please provide a reason for reopening this ticket:"));i&&v.post(n("support.tickets.reopen",t.id),{reason:i})}},X=async()=>{var r;j(!0);try{const x=await(await fetch(n("support.tickets.ai-suggestions"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({ticket_id:t.id})})).json();x.suggestions?u(x.suggestions):u(s("support.ai_suggestions_error","Unable to generate suggestions at this time."))}catch{u(s("support.ai_suggestions_error","Unable to generate suggestions at this time."))}};return e.jsxs(W,{children:[e.jsx(V,{title:`${s("support.ticket","Ticket")} #${t.ticket_number}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(I,{href:n("support.tickets.index"),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),s("common.back","Back")]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["#",t.ticket_number]}),e.jsx(d,{className:C(t.status),variant:"secondary",children:t.status.replace("_"," ")}),e.jsx(d,{className:D(t.priority),variant:"secondary",children:t.priority}),a()&&e.jsxs(d,{variant:"destructive",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Overdue"]})]}),e.jsx("h2",{className:"text-xl text-muted-foreground",children:t.title})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:X,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),s("support.ai_suggestions","AI Suggestions")]}),e.jsx(c,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(I,{href:n("support.tickets.edit",t.id),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),s("common.edit","Edit")]})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(y,{children:[e.jsx(_,{children:e.jsx(w,{children:s("support.description","Description")})}),e.jsx(b,{children:e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:t.description})})})]}),T&&e.jsx(ye,{ticketId:t.id,onApplySuggestion:r=>{m("content",r)}}),e.jsxs(y,{children:[e.jsx(_,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),s("support.comments","Comments")," (",g.data.length,")"]})}),e.jsxs(b,{className:"space-y-4",children:[g.data.map(r=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-8 w-8",children:e.jsx(pe,{children:r.user.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.user.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(r.created_at).toLocaleString()})]})]}),e.jsxs("div",{className:"flex gap-1",children:[r.is_internal&&e.jsx(d,{variant:"secondary",className:"text-xs",children:"Internal"}),r.is_solution&&e.jsx(d,{variant:"default",className:"text-xs",children:"Solution"})]})]}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.content})}),r.time_spent_minutes&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-muted-foreground",children:[e.jsx(ge,{className:"h-3 w-3"}),r.time_spent_minutes," minutes"]}),r.attachments&&r.attachments.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Attachments:"}),r.attachments.map((i,x)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(je,{className:"h-3 w-3"}),e.jsx("a",{href:`/storage/${i.path}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:i.name}),e.jsxs("span",{className:"text-muted-foreground",children:["(",(i.size/1024/1024).toFixed(2)," MB)"]})]},x))]})]},r.id)),g.data.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:s("support.no_comments","No comments yet")})]})]})]}),e.jsxs(y,{children:[e.jsx(_,{children:e.jsx(w,{children:s("support.add_comment","Add Comment")})}),e.jsx(b,{children:e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsx(ie,{value:o.content,onChange:r=>m("content",r.target.value),placeholder:s("support.comment_placeholder","Add your comment..."),rows:4,required:!0}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.is_internal,onChange:r=>m("is_internal",r.target.checked)}),s("support.internal_comment","Internal comment")]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.is_solution,onChange:r=>m("is_solution",r.target.checked)}),s("support.mark_as_solution","Mark as solution")]})]}),e.jsxs(c,{type:"submit",disabled:f,children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),f?s("common.sending","Sending..."):s("support.add_comment","Add Comment")]})]})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(y,{children:[e.jsx(_,{children:e.jsx(w,{children:s("support.ticket_info","Ticket Information")})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-sm font-medium",children:s("support.status","Status")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(d,{className:C(t.status),variant:"secondary",children:t.status.replace("_"," ")}),t.status==="closed"?e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>R("reopen"),children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Reopen"]}):e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>R("closed"),children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Close"]})]})]}),e.jsxs("div",{children:[e.jsx(M,{className:"text-sm font-medium",children:s("support.assigned_to","Assigned To")}),e.jsxs(oe,{value:((B=t.assigned_to)==null?void 0:B.id.toString())||"",onValueChange:N,children:[e.jsx(le,{className:"mt-1",children:e.jsx(ce,{placeholder:s("support.unassigned","Unassigned")})}),e.jsxs(de,{children:[e.jsx(O,{value:"empty",children:s("support.unassigned","Unassigned")}),p.map(r=>e.jsx(O,{value:r.id.toString(),children:r.name},r.id))]})]})]}),e.jsx(U,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("support.created","Created")}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()})]}),t.due_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("support.due_date","Due Date")}),e.jsx("span",{className:a()?"text-red-600 font-medium":"",children:new Date(t.due_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("support.created_by","Created By")}),e.jsx("span",{children:t.created_by.name})]}),t.requester&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("support.requester","Requester")}),e.jsx("span",{children:t.requester.name})]}),t.category&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("support.category","Category")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.category.color}}),e.jsx("span",{children:t.category.name})]})]}),t.sla_policy&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("support.sla","SLA")}),e.jsx("span",{children:t.sla_policy.name})]})]})]})]})})]})]})]})}function M({children:t,className:p}){return e.jsx("label",{className:p,children:t})}export{Ds as default};
